<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§‘ì•ˆì¼ë§¤ë‹ˆì €</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Gaegu&family=Poor+Story&family=Single+Day&family=Hi+Melody&display=swap" rel="stylesheet">
    <!-- Google Sign-In API -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- ì´ë¯¸ì§€ ê´€ë¦¬ íŒŒì¼ -->
    <script src="images.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'êµ´ë¦¼ì²´', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, rgb(95, 240, 167) 0%, rgb(82, 135, 250) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            color: #1e40af;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 700;
        }

        .header .user-info {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 80px;
            z-index: 99;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            color: #666;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            color: rgb(82, 135, 250);
            border-bottom: 2px solid rgb(82, 135, 250);
            font-weight: bold;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .content {
            padding: 20px;
            padding-bottom: 100px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ì˜¤ëŠ˜ í•  ì¼ ì„¹ì…˜ */
        .today-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .task-list {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.3s ease;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-item.completed {
            background-color: #f8f9fa;
            color: #6c757d;
        }

        .task-item.in-progress {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-radius: 50%;
            margin-right: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .task-checkbox.completed {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }

        .task-checkbox.in-progress {
            background-color: #ffc107;
            border-color: #ffc107;
            color: white;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .task-meta {
            font-size: 0.8rem;
            color: #666;
        }

        .task-priority {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 10px;
        }

        .priority-red { background-color: #dc3545; }
        .priority-blue { background-color: rgb(82, 135, 250); }
        .priority-green { background-color: rgb(95, 240, 167); }
        .priority-gray { background-color: #6c757d; }
        .priority-black { background-color: #000000; }

        /* í•  ì¼ ê´€ë¦¬ ì„¹ì…˜ */
        .task-management {
            margin-bottom: 20px;
        }

        .task-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, rgb(95, 240, 167) 0%, rgb(82, 135, 250) 100%);
            color: white;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
            cursor: not-allowed;
            opacity: 0.8;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* ì¡°ê°œ ë³´ìƒ ì„¹ì…˜ */
        .reward-section {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .shell-count {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .shell-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        /* ê°€ì¡± ê´€ë¦¬ ì„¹ì…˜ */
        .family-list {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .family-member {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .family-member:last-child {
            border-bottom: none;
        }

        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgb(95, 240, 167) 0%, rgb(82, 135, 250) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 15px;
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .member-tasks {
            font-size: 0.8rem;
            color: #666;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            .content {
                padding: 15px;
            }
            
            .task-controls {
                flex-direction: column;
            }
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid rgb(82, 135, 250);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ëœë”©í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .landing-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #87CEEB 0%, #5FF0A7 100%);
        }

        .landing-content {
            text-align: center;
            max-width: 500px;
            padding: 40px 20px;
        }

        .app-logo h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #1e40af;
            font-weight: 700;
            letter-spacing: -2px;
            white-space: nowrap;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .app-description {
            font-family: 'Hi Melody', cursive;
            font-size: 1.4rem;
            font-weight: bold;
            color: #555;
            margin-bottom: 40px;
        }

        .auth-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 50px;
            margin-top: 50px;
        }

        .btn-large {
            padding: 15px 30px;
            font-size: 1.1rem;
            min-width: 200px;
        }

        .btn-google {
            background: white;
            color: #333;
            border: 1px solid #dadce0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-google:hover {
            background: #f8f9fa;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn-apple {
            background: white;
            color: #333;
            border: 1px solid #dadce0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-apple:hover {
            background: #f8f9fa;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn-icon {
            width: 20px;
            height: 20px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-top: 30px;
        }

        .feature-item {
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            text-align: center;
        }

        .feature-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }

        .feature-icon {
            margin-bottom: 12px;
            color: rgb(82, 135, 250);
        }

        .feature-icon svg {
            width: 40px;
            height: 40px;
        }

        .feature-item h3 {
            font-size: 0.95rem;
            margin: 0;
            color: #333;
            font-weight: 600;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .auth-modal .modal-content {
            max-width: 400px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            color: rgb(82, 135, 250);
            border-bottom-color: rgb(82, 135, 250);
            font-weight: bold;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .features {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 769px) {
            .auth-buttons {
                flex-direction: row;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .app-logo h1 {
                font-size: 2rem;
                letter-spacing: -0.5px;
            }

            .features {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .feature-item {
                padding: 15px 10px;
            }

            .feature-icon svg {
                width: 32px;
                height: 32px;
            }

            .feature-item h3 {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ëœë”©í˜ì´ì§€ -->
        <div id="landingPage" class="landing-page">
            <div class="landing-content">
                <div class="app-logo">
                    <h1>ğŸ  ì§‘ì•ˆì¼ë§¤ë‹ˆì €</h1>
                    <p class="app-description">ê°€ì¡±ê³¼ í•¨ê»˜í•˜ëŠ” ìŠ¤ë§ˆíŠ¸í•œ ì§‘ì•ˆì¼ ê´€ë¦¬</p>
                </div>
                
                <div class="features">
                    <div class="feature-item">
                        <div class="feature-icon">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                        </div>
                        <h3>ì£¼ê¸°ë³„ í• ì¼</h3>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                        <h3>ê°€ì‚¬ ë¶„ë‹´</h3>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <!-- ë¶€ì±„ê¼´ ì¡°ê°œ ê»ë°ê¸° -->
                                <path d="M 12 21 C 6 21 3 18 3 15 C 3 12 6 10 12 8 C 18 10 21 12 21 15 C 21 18 18 21 12 21 Z"/>
                                <!-- ì¡°ê°œ ë¬´ëŠ¬ ë°©ì‚¬í˜• ì„ ë“¤ (ìœ„ì—ì„œ ì•„ë˜ë¡œ í¼ì³ì§) -->
                                <line x1="12" y1="8" x2="12" y2="21"/>
                                <line x1="12" y1="8" x2="7" y2="19"/>
                                <line x1="12" y1="8" x2="17" y2="19"/>
                                <!-- ì¡°ê°œ ìœ„ìª½ ì‘ì€ ê³ ë¦¬ -->
                                <circle cx="12" cy="8" r="2"/>
                            </svg>
                        </div>
                        <h3>ë³´ìƒ ì‹œìŠ¤í…œ</h3>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <h3>ì•ŒëŒ ê¸°ëŠ¥</h3>
                    </div>
                </div>
                
                <div class="auth-buttons">
                    <button class="btn btn-google btn-large" onclick="loginWithGoogle()" style="min-width: 180px; max-width: 180px; width: 180px;">
                        <svg class="btn-icon" viewBox="0 0 24 24" width="20" height="20">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span style="line-height: 1.3;">Googleë¡œ<br>ê³„ì†í•˜ê¸°</span>
                    </button>
                    <button class="btn btn-apple btn-large" onclick="loginWithApple()" style="min-width: 180px; max-width: 180px; width: 180px;">
                        <svg class="btn-icon" viewBox="0 0 24 24" width="20" height="20">
                            <path fill="#000" d="M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.11-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z"/>
                        </svg>
                        <span style="line-height: 1.3;">Appleë¡œ<br>ê³„ì†í•˜ê¸°</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ (ë¡œê·¸ì¸ í›„ í‘œì‹œ) -->
        <div id="mainApp" class="main-app" style="display: none;">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ  ì§‘ì•ˆì¼ë§¤ë‹ˆì €</h1>
            <div class="user-info">
                <span id="familyGroup">[ê°€ì¡±ê·¸ë£¹ëª…]</span>ì˜ <span id="userNickname">[ë‹‰ë„¤ì„]</span>
                    <button class="btn btn-small" onclick="logout()" style="margin-left: 10px;">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
        <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('today')">ì˜¤ëŠ˜ í• ì¼</button>
            <button class="nav-tab" onclick="showTab('manage')">ë‚´ì¼ í• ì¼</button>
            <button class="nav-tab" onclick="showTab('reward')">ë‚˜ì˜ ì¡°ê°œ</button>
            <button class="nav-tab" onclick="showTab('family')">ê°€ì¡± ê´€ë¦¬</button>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="content">
            <!-- ì˜¤ëŠ˜ í•  ì¼ íƒ­ -->
            <div id="today" class="tab-content active">
                <div class="today-section">
                    <h2 class="section-title">
                        ğŸ“‹ ì˜¤ëŠ˜ í• ì¼ ë¦¬ìŠ¤íŠ¸
                        <span style="font-size: 0.8rem; color: #666; font-weight: normal;">
                            (<span id="todayDate"></span>)
                        </span>
                    </h2>
                    <div class="task-list" id="todayTaskList">
                        <div class="loading">
                            <div class="spinner"></div>
                            í•  ì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                    </div>
                </div>

                <div class="today-section">
                    <h2 class="section-title">ğŸ“… ë‚´ì¼ í•  ì¼ ê³„íš</h2>
                    <div class="task-list" id="tomorrowTaskList">
                        <div class="loading">
                            <div class="spinner"></div>
                            í•  ì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë‚´ì¼ í• ì¼ íƒ­ -->
            <div id="manage" class="tab-content">
                <div class="task-management">
                    <h2 class="section-title">ğŸ“… ë‚´ì¼ í• ì¼</h2>
                    
                    <div class="task-controls">
                        <button class="btn btn-primary" onclick="openAddTaskModal()">
                            ğŸ  ê°€ì¡± ì§‘ì•ˆì¼ ê´€ë¦¬
                        </button>
                    </div>

                    <div class="task-list" id="allTaskList">
                        <div class="loading">
                            <div class="spinner"></div>
                            í•  ì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                        </div>
                    </div>
                </div>
            </div>

            <!-- ë‚˜ì˜ ì¡°ê°œ íƒ­ -->
            <div id="reward" class="tab-content">
                <div class="reward-section">
                    <div class="shell-icon">ğŸš</div>
                    <div class="shell-count" id="shellCount">0</div>
                    <p>ë‚˜ì˜ ì¡°ê°œ</p>
                    <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 10px;">
                        í•  ì¼ì„ ì™„ë£Œí•  ë•Œë§ˆë‹¤ ì¡°ê°œë¥¼ íšë“í•©ë‹ˆë‹¤!
                    </p>
                </div>

                <div class="task-list">
                    <div class="task-item">
                        <div class="task-info">
                            <div class="task-name">ì˜¤ëŠ˜ ì™„ë£Œí•œ í•  ì¼</div>
                            <div class="task-meta" id="todayCompletedCount">0ê°œ</div>
                        </div>
                    </div>
                    <div class="task-item">
                        <div class="task-info">
                            <div class="task-name">ì´ë²ˆ ì£¼ ì™„ë£Œí•œ í•  ì¼</div>
                            <div class="task-meta" id="weekCompletedCount">0ê°œ</div>
                        </div>
                    </div>
                    <div class="task-item">
                        <div class="task-info">
                            <div class="task-name">ì´ë²ˆ ë‹¬ ì™„ë£Œí•œ í•  ì¼</div>
                            <div class="task-meta" id="monthCompletedCount">0ê°œ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê°€ì¡± ê´€ë¦¬ íƒ­ -->
            <div id="family" class="tab-content">
                <div class="task-management">
                    <h2 class="section-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡± ê´€ë¦¬</h2>
                    
                    <!-- ë‚´ê°€ ì†í•œ ê°€ì¡± ì„¹ì…˜ -->
                    <div class="family-section" style="margin-bottom: 2rem;">
                        <h3 style="font-size: 1.2rem; margin-bottom: 1rem; color: #333;">ğŸ“‹ ë‚´ê°€ ì†í•œ ê°€ì¡±</h3>
                        <div id="myFamiliesList" class="my-families-list">
                            <div class="loading">ê°€ì¡± ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                        </div>
                    </div>

                    <!-- ê°€ì¡± ê´€ë¦¬ ë²„íŠ¼ -->
                    <div class="task-controls" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="openInviteModal()">
                            ğŸ“± ê°€ì¡±ì› ì´ˆëŒ€
                        </button>
                        <button class="btn btn-primary" onclick="openFindFamilyModal()">
                            ğŸ” ê°€ì¡± ì°¾ê¸°
                        </button>
                        <button class="btn btn-secondary" onclick="openAlarmModal()">
                            ğŸ”” ì•ŒëŒ ì„¤ì •
                        </button>
                    </div>

                    <!-- í˜„ì¬ ì„ íƒëœ ê°€ì¡±ì˜ êµ¬ì„±ì› ëª©ë¡ -->
                    <div class="family-members-section" style="margin-top: 2rem;">
                        <h3 style="font-size: 1.2rem; margin-bottom: 1rem; color: #333;">ğŸ‘¥ ê°€ì¡± êµ¬ì„±ì›</h3>
                    <div class="family-list" id="familyList">
                            <div class="empty-state">ê°€ì¡±ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•  ì¼ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ìƒˆë¡œìš´ í•  ì¼ ì¶”ê°€</h3>
                <button class="close-btn" onclick="closeModal('addTaskModal')">&times;</button>
            </div>
            <form id="addTaskForm">
                <div class="form-group">
                    <label class="form-label">í•  ì¼ ì´ë¦„</label>
                    <input type="text" class="form-input" id="taskName" placeholder="ì˜ˆ: ì„¤ê±°ì§€, ë°”ë‹¥ì²­ì†Œ ë“±" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
                    <select class="form-select" id="taskCategory" required>
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <!-- ì¹´í…Œê³ ë¦¬ëŠ” ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ì£¼ê¸°</label>
                    <select class="form-select" id="taskCycle" required onchange="handleCycleChange()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="custom_days">ë©°ì¹ ë§ˆë‹¤</option>
                        <option value="custom_weeks">ëª‡ì£¼ë§ˆë‹¤</option>
                    </select>
                </div>
                
                <!-- ì»¤ìŠ¤í…€ ì£¼ê¸° ì…ë ¥ -->
                <div class="form-group" id="customCycleGroup" style="display: none;">
                    <label class="form-label" id="customCycleLabel">ê°„ê²©</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="number" class="form-input" id="customCycleValue" min="1" max="6" style="width: 80px;">
                        <span id="customCycleUnit">ì¼</span>
                    </div>
                    <div class="task-meta" id="customCycleHint" style="margin-top: 5px; color: #666;">
                        1ì¼ë¶€í„° 6ì¼ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </div>
                </div>
                <div class="task-controls">
                    <button type="submit" class="btn btn-primary">ì¶”ê°€í•˜ê¸°</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addTaskModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ê°€ì¡± ì´ˆëŒ€ ëª¨ë‹¬ -->
    <!-- ê°€ì¡± ì°¾ê¸° ëª¨ë‹¬ -->
    <div id="findFamilyModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ” ê°€ì¡± ì°¾ê¸°</h3>
                <button class="close-btn" onclick="closeModal('findFamilyModal')">&times;</button>
            </div>
            <div style="padding: 1rem 0;">
                <p style="color: #666; margin-bottom: 1.5rem;">
                    ê¸°ì¡´ì— ë“±ë¡ëœ ê°€ì¡±ì„ ì°¾ì•„ì„œ ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div class="form-group">
                    <label class="form-label">ê°€ì¡± ì´ë¦„</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" class="form-input" id="searchFamilyName" placeholder="ê°€ì¡± ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" onkeypress="if(event.key==='Enter'){searchFamily();event.preventDefault();}">
                        <button type="button" class="btn btn-primary" onclick="searchFamily()" style="white-space: nowrap;">ì°¾ê¸°</button>
                </div>
                </div>
                
                <!-- ê²€ìƒ‰ ê²°ê³¼ -->
                <div id="searchFamilyResult" style="margin-top: 1rem;"></div>
                
                <!-- ë¹„ìŠ·í•œ ê°€ì¡± ëª©ë¡ -->
                <div id="similarFamiliesSection" style="display: none; margin-top: 1.5rem; border-top: 1px solid #e5e7eb; padding-top: 1.5rem;">
                    <h4 style="font-size: 1rem; margin-bottom: 1rem; color: #666;">í˜¹ì‹œ ì´ ê°€ì¡±ì…ë‹ˆê¹Œ?</h4>
                    <div id="similarFamiliesList"></div>
                </div>
                
                <!-- ìƒˆ ê°€ì¡± ë“±ë¡ ì˜µì…˜ -->
                <div id="createNewFamilySection" style="display: none; margin-top: 1.5rem; border-top: 1px solid #e5e7eb; padding-top: 1.5rem;">
                    <p style="color: #666; margin-bottom: 1rem;">
                        ì°¾ìœ¼ì‹œëŠ” ê°€ì¡±ì´ ì—†ìœ¼ì‹ ê°€ìš”?
                    </p>
                    <button type="button" class="btn btn-primary" onclick="openCreateFamilyFromSearch()" style="width: 100%;">
                        â• ìƒˆ ê°€ì¡± ë§Œë“¤ê¸°
                    </button>
                </div>
                
                <!-- ê°€ì… ì–‘ì‹ (ê²€ìƒ‰ ì„±ê³µ ì‹œ í‘œì‹œ) -->
                <form id="joinFamilyForm" style="display: none; margin-top: 1.5rem; border-top: 1px solid #e5e7eb; padding-top: 1.5rem;">
                    <input type="hidden" id="selectedFamilyId">
                    <input type="hidden" id="selectedFamilyName">
                    
                    <div style="margin-bottom: 1rem; padding: 1rem; background: #eff6ff; border-radius: 8px;">
                        <strong id="selectedFamilyDisplay"></strong>
                    </div>
                    
                <div class="form-group">
                    <label class="form-label">ê°€ì¡± ë‚´ ë‹‰ë„¤ì„</label>
                        <input type="text" class="form-input" id="joinFamilyNickname" placeholder="ì˜ˆ: ì—„ë§ˆ, ì•„ë¹ , í˜• ë“±" required>
                </div>
                <div class="task-controls">
                        <button type="submit" class="btn btn-primary">ê°€ì¡± ê°€ì…í•˜ê¸°</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelJoinFamily()">ì·¨ì†Œ</button>
                </div>
            </form>
            </div>
        </div>
    </div>

    <!-- ê°€ì¡± ì´ˆëŒ€ ëª¨ë‹¬ -->
    <div id="inviteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ“± ê°€ì¡±ì› ì´ˆëŒ€</h3>
                <button class="close-btn" onclick="closeModal('inviteModal')">&times;</button>
            </div>
            <div style="padding: 1rem 0;">
                <p style="color: #666; margin-bottom: 1.5rem;">
                    ê°€ì¡± ì´ˆëŒ€ ë§í¬ë¥¼ ìƒì„±í•˜ì—¬ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div class="form-group">
                    <label class="form-label">í˜„ì¬ ê°€ì¡±</label>
                    <div class="form-input" style="background: #f9fafb; border: none;" id="currentFamilyName">-</div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì´ˆëŒ€ ë§í¬</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" class="form-input" id="inviteLink" readonly style="background: #f9fafb;">
                        <button type="button" class="btn btn-primary" onclick="copyInviteLink()" style="white-space: nowrap;">ë³µì‚¬</button>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: #fef3c7; border-radius: 8px; font-size: 0.875rem;">
                    ğŸ’¡ ì´ ë§í¬ë¥¼ ê°€ì¡± êµ¬ì„±ì›ì—ê²Œ ê³µìœ í•˜ë©´ ìë™ìœ¼ë¡œ ê°€ì¡±ì— ê°€ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
                <div class="task-controls" style="margin-top: 1.5rem;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('inviteModal')">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•ŒëŒ ì„¤ì • ëª¨ë‹¬ -->
    <div id="alarmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ì•ŒëŒ ì„¤ì •</h3>
                <button class="close-btn" onclick="closeModal('alarmModal')">&times;</button>
            </div>
            <form id="alarmForm">
                <div class="form-group">
                    <label class="form-label">ì•ŒëŒ ì‹œê°„</label>
                    <input type="time" class="form-input" id="alarmTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ì•ŒëŒ ìš”ì¼</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <label><input type="checkbox" value="mon"> ì›”</label>
                        <label><input type="checkbox" value="tue"> í™”</label>
                        <label><input type="checkbox" value="wed"> ìˆ˜</label>
                        <label><input type="checkbox" value="thu"> ëª©</label>
                        <label><input type="checkbox" value="fri"> ê¸ˆ</label>
                        <label><input type="checkbox" value="sat"> í† </label>
                        <label><input type="checkbox" value="sun"> ì¼</label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">ì•ŒëŒ ë°©ì‹</label>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <label><input type="checkbox" value="app"> ì•± í‘¸ì‹œ</label>
                        <label><input type="checkbox" value="kakao"> ì¹´í†¡ ì „ì†¡</label>
                    </div>
                </div>
                <div class="task-controls">
                    <button type="submit" class="btn btn-primary">ì„¤ì • ì €ì¥</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('alarmModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- í…œí”Œë¦¿ ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">í•  ì¼ í…œí”Œë¦¿ ì¶”ê°€</h3>
                <button class="close-btn" onclick="closeModal('templateModal')">&times;</button>
            </div>
            <form id="templateForm">
                <div class="form-group">
                    <label class="form-label">ì£¼ê¸° ì„ íƒ</label>
                    <select class="form-select" id="templateCycle" required onchange="loadTemplateTasks()">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="daily">ë§¤ì¼</option>
                        <option value="weekly">ë§¤ì£¼</option>
                        <option value="monthly">4ì£¼</option>
                        <option value="quarterly">12ì£¼</option>
                        <option value="yearly">52ì£¼</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">ì¶”ê°€í•  í•  ì¼ë“¤</label>
                    <div id="templateTaskList" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                        <p style="color: #666; text-align: center; margin: 20px 0;">ì£¼ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                    </div>
                </div>
                <div class="task-controls">
                    <button type="submit" class="btn btn-primary">í…œí”Œë¦¿ ì¶”ê°€</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('templateModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ìš°ë¦¬ì§‘ ì§‘ì•ˆì¼ ë“±ë¡ ëª¨ë‹¬ -->
    <div id="choreSetupModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ  ìš°ë¦¬ì§‘ ì§‘ì•ˆì¼ ë“±ë¡</h3>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 10px;">
                <p style="margin: 0; color: #1e40af; font-weight: 500;">
                    ìš°ë¦¬ì§‘ì—ì„œ í•  ì§‘ì•ˆì¼ì„ ì„ íƒí•˜ê³  ì£¼ê¸°ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.<br>
                    <span style="font-size: 0.9rem; color: #64748b;">ì²´í¬ë¥¼ í•´ì œí•˜ë©´ í•´ë‹¹ ì§‘ì•ˆì¼ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.</span>
                </p>
            </div>

            <form id="choreSetupForm">
                <div id="choreSetupList" style="max-height: 500px; overflow-y: auto; padding: 10px;">
                    <div style="text-align: center; padding: 40px; color: #94a3b8;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ§¹</div>
                        ì§‘ì•ˆì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>

                <div class="task-controls" style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" id="choreSetupSubmitBtn">
                        âœ… ì„¤ì • ì™„ë£Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì•„ì´í…œ ì„ íƒ ëª¨ë‹¬ -->
    <div id="itemSelectionModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ  ê°€ì¡± ì•„ì´í…œ ì„ íƒ</h3>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 10px;">
                <p style="margin: 0; color: #1e40af; font-weight: 500;">
                    ë‹¤ìŒ ì¤‘ ê°€ì¡±ì´ ì†Œìœ í•œ ì•„ì´í…œì— ì²´í¬í•´ì£¼ì„¸ìš”.<br>
                    <span style="font-size: 0.9rem; color: #64748b;">ì²´í¬í•˜ì§€ ì•Šì€ ì•„ì´í…œê³¼ ê´€ë ¨ëœ ë‚´ìš©ì€ ê¸°ë³¸ ì§‘ì•ˆì¼ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</span>
                </p>
            </div>

            <form id="itemSelectionForm">
                <div id="itemsList" style="max-height: 400px; overflow-y: auto; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; background: white;">
                    <div style="text-align: center; padding: 40px; color: #94a3b8;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ“¦</div>
                        ì•„ì´í…œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                    </div>
                </div>

                <div class="task-controls" style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary" id="itemSubmitBtn">
                        âœ… ì„ íƒ ì™„ë£Œ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ê°€ì¡± ë“±ë¡ ëª¨ë‹¬ -->
    <div id="familyRegistrationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ğŸ  ê°€ì¡± ë“±ë¡</h3>
            </div>
            
            <div style="text-align: center; margin-bottom: 20px; color: #666;">
                <p>ê°€ì¡± ê·¸ë£¹ì— ê°€ì…í•˜ê±°ë‚˜ ìƒˆë¡œìš´ ê°€ì¡±ì„ ë§Œë“œì„¸ìš”</p>
            </div>

            <!-- ê°€ì¡± ì´ë¦„ ì…ë ¥ -->
            <form id="familyRegistrationForm">
                <div class="form-group">
                    <label class="form-label">ê°€ì¡± ì´ë¦„</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" class="form-input" id="familyNameInput" 
                               placeholder="ì˜ˆ: ê¹€ì”¨ë„¤ ê°€ì¡±, í–‰ë³µí•œ ìš°ë¦¬ì§‘" 
                               required style="flex: 1;">
                        <button type="button" class="btn btn-secondary" onclick="checkFamilyName()" 
                                style="white-space: nowrap;">
                            ğŸ” ì°¾ê¸° ë° ì¤‘ë³µí™•ì¸
                        </button>
                    </div>
                    <div id="familyCheckResult" style="margin-top: 10px; font-size: 0.9rem;"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">ê°€ì¡± ë‚´ ë‹‰ë„¤ì„</label>
                    <input type="text" class="form-input" id="familyNicknameInput" 
                           placeholder="ì˜ˆ: ì•„ë¹ , ì—„ë§ˆ, í°ì•„ë“¤" required>
                </div>

                <!-- ê¸°ì¡´ ê°€ì¡± ì°¾ì€ ê²½ìš° í‘œì‹œë  ì˜ì—­ -->
                <div id="existingFamilyInfo" style="display: none; margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid rgb(82, 135, 250);">
                        <div style="font-weight: bold; margin-bottom: 10px;">âœ… ê¸°ì¡´ ê°€ì¡± ì°¾ìŒ</div>
                        <div id="existingFamilyDetails" style="font-size: 0.9rem; color: #666;"></div>
                        <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 5px;">
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="confirmJoinFamily" style="margin-right: 8px;">
                                <span>ì´ ê°€ì¡±ì— ê°€ì…í•˜ê² ìŠµë‹ˆë‹¤</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="task-controls">
                    <button type="submit" class="btn btn-primary" id="familyRegisterBtn">
                        ê°€ì¡± ë“±ë¡
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë‹¬ -->
    <div id="authModal" class="modal auth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ì§‘ì•ˆì¼ë§¤ë‹ˆì €</h3>
                <button class="close-btn" onclick="closeModal('authModal')">&times;</button>
            </div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">ë¡œê·¸ì¸</button>
                <button class="auth-tab" onclick="switchAuthTab('signup')">íšŒì›ê°€ì…</button>
            </div>

            <!-- ë¡œê·¸ì¸ í¼ -->
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label class="form-label">ì´ë©”ì¼</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="task-controls">
                    <button type="submit" class="btn btn-primary">ë¡œê·¸ì¸</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('authModal')">ì·¨ì†Œ</button>
                </div>
            </form>

            <!-- íšŒì›ê°€ì… í¼ -->
            <form id="signupForm" class="auth-form">
                <div class="form-group">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" class="form-input" id="signupName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ì´ë©”ì¼</label>
                    <input type="email" class="form-input" id="signupEmail" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" class="form-input" id="signupPhone" placeholder="010-1234-5678" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="form-input" id="signupPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" class="form-input" id="signupPasswordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ê°€ì¡± ë‚´ ë‹‰ë„¤ì„</label>
                    <input type="text" class="form-input" id="signupNickname" placeholder="ì˜ˆ: ì•„ë¹ , ì—„ë§ˆ, í˜• ë“±" required>
                </div>
                <div class="task-controls">
                    <button type="submit" class="btn btn-primary">íšŒì›ê°€ì…</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('authModal')">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = {
            id: 'USER001',
            name: 'ì‚¬ìš©ì',
            nickname: 'ë‹‰ë„¤ì„',
            familyGroup: 'ìš°ë¦¬ê°€ì¡±',
            shellCount: 0
        };
        
        // ê°œë°œ ëª¨ë“œìš© ì„ì‹œ ë°ì´í„° ì €ì¥ì†Œ
        let devModeAssignedChores = [];

        let tasks = [];
        let familyMembers = [];
        
        // Google Apps Script ì›¹ì•± URL
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwF_pAATqpjfwEHIYxLY4RiFg1O7RqpJGiAzhbWqCONh0uucjtn4L2YKb6zSBOqL8HdcA/exec';
        
        // ê°œë°œ ëª¨ë“œ ê°ì§€ (localhost)
        const isDevelopmentMode = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // ì•± ì´ˆê¸°í™”
        function initializeApp() {
            // Google Sign-In ì´ˆê¸°í™”
            setTimeout(() => {
                initializeGoogleSignIn();
            }, 1000);
            
            // OAuth ì½œë°± ì²˜ë¦¬
            handleOAuthCallback();
            
            // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
            checkLoginStatus();
            
            // í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (ìš”ì†Œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ)
            const addTaskForm = document.getElementById('addTaskForm');
            if (addTaskForm) addTaskForm.addEventListener('submit', handleAddTask);
            
            const joinFamilyForm = document.getElementById('joinFamilyForm');
            if (joinFamilyForm) joinFamilyForm.addEventListener('submit', handleJoinFamily);
            
            const inviteForm = document.getElementById('inviteForm');
            if (inviteForm) inviteForm.addEventListener('submit', handleInvite);
            
            const alarmForm = document.getElementById('alarmForm');
            if (alarmForm) alarmForm.addEventListener('submit', handleAlarmSetting);
            
            const templateForm = document.getElementById('templateForm');
            if (templateForm) templateForm.addEventListener('submit', handleTemplateAdd);
            
            const loginForm = document.getElementById('loginForm');
            if (loginForm) loginForm.addEventListener('submit', handleLogin);
            
            const signupForm = document.getElementById('signupForm');
            if (signupForm) signupForm.addEventListener('submit', handleSignup);
        }

        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const savedUser = localStorage.getItem('currentUser');
            
            if (isLoggedIn && savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
                loadAppData();
            } else {
                showLandingPage();
            }
        }

        // ëœë”©í˜ì´ì§€ í‘œì‹œ
        function showLandingPage() {
            document.getElementById('landingPage').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        }

        // ë©”ì¸ ì•± í‘œì‹œ
        function showMainApp() {
            document.getElementById('landingPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadAppData();
        }

        // ì•± ë°ì´í„° ë¡œë“œ
        async function loadAppData() {
            updateUserInfo();
            updateTodayDate();
            loadTasks();
            loadFamilyMembers();
            loadShellCount();
            loadCategories();
            
            // ê°€ì¡± ë°ì´í„°ë„ ë¯¸ë¦¬ ë¡œë“œ (ê°€ì¡± íƒ­ ì§„ì… ì‹œ ë¹ ë¥´ê²Œ í‘œì‹œí•˜ê¸° ìœ„í•¨)
            if (currentUser && currentUser.id) {
                await loadMyFamilies();
            }
        }

        // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
        function updateUserInfo() {
            document.getElementById('familyGroup').textContent = currentUser.familyGroup;
            document.getElementById('userNickname').textContent = currentUser.nickname;
        }

        // ì˜¤ëŠ˜ ë‚ ì§œ ì—…ë°ì´íŠ¸
        function updateTodayDate() {
            const today = new Date();
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            document.getElementById('todayDate').textContent = today.toLocaleDateString('ko-KR', options);
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ì„ íƒëœ íƒ­ í™œì„±í™” (eventê°€ ìˆì„ ê²½ìš°ì—ë§Œ ì‚¬ìš©)
            if (window.event && window.event.target) {
                window.event.target.classList.add('active');
            } else {
                // ì§ì ‘ í˜¸ì¶œëœ ê²½ìš° íƒ­ ë²„íŠ¼ ì°¾ì•„ì„œ í™œì„±í™”
                const tabButtons = document.querySelectorAll('.nav-tab');
                const tabIndex = ['today', 'manage', 'reward', 'family'].indexOf(tabName);
                if (tabIndex >= 0 && tabButtons[tabIndex]) {
                    tabButtons[tabIndex].classList.add('active');
                }
            }
            
            document.getElementById(tabName).classList.add('active');
            
            // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            switch(tabName) {
                case 'today':
                    loadTodayTasks();
                    break;
                case 'manage':
                    loadAllTasks();
                    break;
                case 'reward':
                    loadRewardData();
                    break;
                case 'family':
                    loadFamilyData();
                    break;
            }
        }

        // Google Apps Script API í˜¸ì¶œ í•¨ìˆ˜
        async function callGAS(action, data = {}) {
            console.log('ğŸ”„ GAS API í˜¸ì¶œ:', action, data);
            
            // ê°œë°œ ëª¨ë“œì—ì„œëŠ” ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
            if (isDevelopmentMode) {
                console.log('ğŸ”§ ê°œë°œ ëª¨ë“œ: ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©');
                return new Promise((resolve) => {
                    setTimeout(() => {
                        const sampleData = getSampleData(action, data);
                        console.log('âœ… ìƒ˜í”Œ ë°ì´í„° ë°˜í™˜:', sampleData);
                        resolve(sampleData);
                    }, 300); // ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œë®¬ë ˆì´ì…˜
                });
            }
            
            // í”„ë¡œë•ì…˜ ëª¨ë“œì—ì„œëŠ” ì‹¤ì œ ì„œë²„ í˜¸ì¶œ
            try {
                const formData = new FormData();
                formData.append('action', action);
                formData.append('data', JSON.stringify(data));
                
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    body: formData,
                    mode: 'cors'
                });
                
                console.log('ğŸ“¡ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('âŒ HTTP ì˜¤ë¥˜ ì‘ë‹µ:', errorText);
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${response.status}): ${response.statusText}`);
                }
                
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    const text = await response.text();
                    console.error('âŒ JSONì´ ì•„ë‹Œ ì‘ë‹µ:', text.substring(0, 200));
                    throw new Error('ì„œë²„ê°€ ì˜¬ë°”ë¥¸ í˜•ì‹ì˜ ì‘ë‹µì„ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                const result = await response.json();
                console.log('âœ… GAS API ì‘ë‹µ:', result);
                
                if (!result.success && result.success !== undefined) {
                    console.error('âŒ API ì˜¤ë¥˜:', result.message);
                    throw new Error(result.message || 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
                
                return result.data;
            } catch (error) {
                console.error('âŒ GAS API í˜¸ì¶œ ì˜¤ë¥˜:', error);
                throw error;
            }
        }

        // ìƒ˜í”Œ ë°ì´í„° ë°˜í™˜ (ê°œë°œ/ì˜¤í”„ë¼ì¸ìš©)
        function getSampleData(action, data) {
            switch(action) {
                case 'getTasks':
                    // ê°œë°œ ëª¨ë“œ: localStorageì—ì„œ í• ë‹¹ëœ ì§‘ì•ˆì¼ ë¶ˆëŸ¬ì˜¤ê¸°
                    const savedChores = localStorage.getItem('devModeAssignedChores');
                    if (savedChores) {
                        devModeAssignedChores = JSON.parse(savedChores);
                    }
                    
                    // ë‚˜ì—ê²Œ í• ë‹¹ëœ ì§‘ì•ˆì¼ë§Œ ë°˜í™˜ (ì˜¤ëŠ˜ í• ì¼ìš©)
                    const myAssignedChores = devModeAssignedChores.filter(c => 
                        c.assignee === currentUser.idInFamily
                    );
                    
                    if (myAssignedChores.length > 0) {
                        return myAssignedChores.map(chore => ({
                            task_id: chore.chore_id,
                            task_name: chore.chore_name,
                            category: chore.choregroup_name,
                            cycle: chore.freq_type === 'd' ? 'daily' : 'weekly',
                            assignee_id: chore.assignee,
                            last_date: new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            next_date: chore.due_date,
                            status: chore.status,
                            priority: chore.color,
                            created_at: chore.assigned_at
                        }));
                    }
                    
                    // ê¸°ë³¸ ìƒ˜í”Œ ë°ì´í„°
                    return [
                        {
                            task_id: 'CHORE001',
                            task_name: 'ì„¤ê±°ì§€',
                            category: 'ì£¼ë°©',
                            cycle: 'daily',
                            assignee_id: 'IDF001-01',
                            last_date: '2024-09-29',
                            next_date: '2024-09-30',
                            status: 'todo',
                            priority: 'red',
                            created_at: new Date().toISOString()
                        },
                        {
                            task_id: 'CHORE002',
                            task_name: 'ë°”ë‹¥ì²­ì†Œ',
                            category: 'ê±°ì‹¤',
                            cycle: 'daily',
                            assignee_id: 'IDF001-01',
                            last_date: '2024-09-29',
                            next_date: '2024-09-30',
                            status: 'todo',
                            priority: 'red',
                            created_at: new Date().toISOString()
                        },
                        {
                            task_id: 'CHORE003',
                            task_name: 'í™”ì¥ì‹¤ ì²­ì†Œ',
                            category: 'í™”ì¥ì‹¤',
                            cycle: 'weekly',
                            assignee_id: 'IDF001-01',
                            last_date: '2024-09-23',
                            next_date: '2024-09-30',
                            status: 'todo',
                            priority: 'blue',
                            created_at: new Date().toISOString()
                        },
                        {
                            task_id: 'CHORE004',
                            task_name: 'ë² ë€ë‹¤ ì •ë¦¬',
                            category: 'ë² ë€ë‹¤',
                            cycle: 'weekly',
                            assignee_id: 'IDF001-02',
                            last_date: '2024-09-23',
                            next_date: '2024-09-30',
                            status: 'todo',
                            priority: 'green',
                            created_at: new Date().toISOString()
                        },
                        {
                            task_id: 'CHORE005',
                            task_name: 'ì°¨ëŸ‰ ì„¸ì°¨',
                            category: 'ì°¨',
                            cycle: 'custom_weeks_2',
                            assignee_id: 'IDF001-02',
                            last_date: '2024-09-16',
                            next_date: '2024-10-01',
                            status: 'todo',
                            priority: 'black',
                            created_at: new Date().toISOString()
                        }
                    ];
                case 'getFamilyMembers':
                    return [
                        { user_id: 'USER001', name: 'ê¹€ì² ìˆ˜', nickname: 'ì•„ë¹ ', phone: '010-1234-5678', shell_count: 15 },
                        { user_id: 'USER002', name: 'ê¹€ì˜í¬', nickname: 'ì—„ë§ˆ', phone: '010-2345-6789', shell_count: 20 }
                    ];
                case 'getUserInfo':
                    return {
                        user_id: 'USER001',
                        name: 'ê¹€ì² ìˆ˜',
                        family_id: 'FAMILY001',
                        shell_person: 15
                    };
                case 'getCategories':
                    return ['ì£¼ë°©', 'ê±°ì‹¤', 'ì•ˆë°©', 'ë‹¤ë¥¸ë°©', 'í™”ì¥ì‹¤', 'ë² ë€ë‹¤', 'í˜„ê´€', 'ìë™ì°¨', 'ê°•ì•„ì§€', 'ì •ì›', 'ê³„ì ˆ', 'ê¸°íƒ€'];
                
                case 'checkFamilyName':
                    // ê°œë°œ ëª¨ë“œìš© ìƒ˜í”Œ ì‘ë‹µ
                    const searchName = data.familyName || '';
                    
                    // ìƒ˜í”Œ ê°€ì¡± ë°ì´í„°
                    const sampleFamilies = [
                        { id: 'FAM001', name: 'ìŠ¹ê·œë„¤', memberCount: 3, created_at: '2024-09-01T00:00:00Z' },
                        { id: 'FAM002', name: 'ìŠ¹ê·œë„¤ì§‘', memberCount: 2, created_at: '2024-09-15T00:00:00Z' },
                        { id: 'FAM003', name: 'í–‰ë³µí•œì§‘', memberCount: 4, created_at: '2024-08-01T00:00:00Z' }
                    ];
                    
                    // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°€ì¡± ì°¾ê¸°
                    const exactMatch = sampleFamilies.find(f => f.name === searchName);
                    if (exactMatch) {
                        return {
                            exists: true,
                            exactMatch: true,
                            family: exactMatch
                        };
                    }
                    
                    // ë¹„ìŠ·í•œ ê°€ì¡± ì°¾ê¸°
                    const similarFamilies = sampleFamilies.filter(f => 
                        f.name.includes(searchName) || searchName.includes(f.name)
                    );
                    
                    return {
                        exists: false,
                        exactMatch: false,
                        similarFamilies: similarFamilies
                    };
                
                case 'createFamily':
                    const newFamilyId = 'FAM' + Date.now();
                    return {
                        success: true,
                        familyId: newFamilyId,
                        familyName: data.familyName,
                        idInFamily: newFamilyId + '_1',
                        joinDate: new Date().toISOString().split('T')[0],
                        message: 'ê°€ì¡±ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.'
                    };
                
                case 'joinFamily':
                    return {
                        success: true,
                        familyId: data.familyId,
                        familyName: 'ìŠ¹ê·œë„¤',  // ìƒ˜í”Œ ê°€ì¡±ëª…
                        idInFamily: data.familyId + '_' + Math.floor(Math.random() * 10 + 2),
                        joinDate: new Date().toISOString().split('T')[0],
                        message: 'ê°€ì¡±ì— ê°€ì…ë˜ì—ˆìŠµë‹ˆë‹¤.'
                    };
                
                case 'getAllFamiliesByUserId':
                    return [
                        {
                            family_id: 'FAM001',
                            family_name: 'ìŠ¹ê·œë„¤',
                            id_infamily: 'FAM001_1',
                            nick_infamily: 'ì•„ë¹ ',
                            role: 'owner'
                        }
                    ];
                
                case 'getFamilyMembers':
                    return [
                        { id_infamily: 'FAM001_1', nick_infamily: 'ì•„ë¹ ', role: 'owner' },
                        { id_infamily: 'FAM001_2', nick_infamily: 'ì—„ë§ˆ', role: 'member' },
                        { id_infamily: 'FAM001_3', nick_infamily: 'í°ì•„ë“¤', role: 'member' }
                    ];
                
                case 'getFamilyChores':
                    // ê°œë°œ ëª¨ë“œìš© ìƒ˜í”Œ ì§‘ì•ˆì¼ ë°ì´í„°
                    // localStorageì—ì„œ í• ë‹¹ëœ ì§‘ì•ˆì¼ ë¶ˆëŸ¬ì˜¤ê¸°
                    const savedFamilyChores = localStorage.getItem('devModeAssignedChores');
                    if (savedFamilyChores) {
                        devModeAssignedChores = JSON.parse(savedFamilyChores);
                    }
                    
                    const today = new Date();
                    const baseChores = [
                        {
                            chore_id: 'C001',
                            chore_name: 'ì„¤ê±°ì§€',
                            choregroup_name: 'ì£¼ë°©',
                            freq_type: 'd',
                            freq_value: 1,
                            item_id: 'ITEM001',
                            template: '1',
                            use: 'Y',
                            last_date: new Date(today.getTime() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            due_date: null,
                            assignee: null,
                            status: 'todo',
                            color: 'red'  // ë§¤ì¼ - ë¹¨ê°• (ê¸´ê¸‰)
                        },
                        {
                            chore_id: 'C002',
                            chore_name: 'ë°”ë‹¥ ì²­ì†Œ',
                            choregroup_name: 'ê±°ì‹¤',
                            freq_type: 'd',
                            freq_value: 3,
                            item_id: null,
                            template: '1',
                            use: 'Y',
                            last_date: new Date(today.getTime() - 4 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            due_date: null,
                            assignee: null,
                            status: 'todo',
                            color: 'blue'  // 3ì¼ë§ˆë‹¤ - íŒŒë‘ (ë³´í†µ)
                        },
                        {
                            chore_id: 'C003',
                            chore_name: 'í™”ì¥ì‹¤ ì²­ì†Œ',
                            choregroup_name: 'í™”ì¥ì‹¤',
                            freq_type: 'w',
                            freq_value: 1,
                            item_id: null,
                            template: '1',
                            use: 'Y',
                            last_date: new Date(today.getTime() - 8 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            due_date: null,
                            assignee: null,
                            status: 'todo',
                            color: 'green'  // 1ì£¼ë§ˆë‹¤ - ì´ˆë¡ (ì—¬ìœ )
                        },
                        {
                            chore_id: 'C004',
                            chore_name: 'ì„¸íƒ',
                            choregroup_name: 'ì£¼ë°©',
                            freq_type: 'd',
                            freq_value: 2,
                            item_id: 'ITEM002',
                            template: '1',
                            use: 'Y',
                            last_date: new Date(today.getTime() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            due_date: null,
                            assignee: null,
                            status: 'todo',
                            color: 'blue'  // 2ì¼ë§ˆë‹¤ - íŒŒë‘ (ë³´í†µ)
                        },
                        {
                            chore_id: 'C005',
                            chore_name: 'ë² ë€ë‹¤ ì •ë¦¬',
                            choregroup_name: 'ë² ë€ë‹¤',
                            freq_type: 'w',
                            freq_value: 2,
                            item_id: null,
                            template: '1',
                            use: 'Y',
                            last_date: new Date(today.getTime() - 15 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            due_date: null,
                            assignee: null,
                            status: 'todo',
                            color: 'gray'  // 2ì£¼ë§ˆë‹¤ - íšŒìƒ‰ (ë‚®ì€ ìš°ì„ ìˆœìœ„)
                        },
                        {
                            chore_id: 'C006',
                            chore_name: 'ëƒ‰ì¥ê³  ì •ë¦¬',
                            choregroup_name: 'ì£¼ë°©',
                            freq_type: 'w',
                            freq_value: 1,
                            item_id: 'ITEM001',
                            template: '1',
                            use: 'Y',
                            last_date: new Date(today.getTime() - 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            due_date: null,
                            assignee: null,
                            status: 'todo',
                            color: 'black'  // 1ì£¼ë§ˆë‹¤ - ê²€ì • (í•„ìˆ˜)
                        }
                    ];
                    
                    // í• ë‹¹ëœ ì§‘ì•ˆì¼ì˜ assignee ì •ë³´ë¥¼ baseChoresì— ë°˜ì˜
                    return baseChores.map(chore => {
                        const assigned = devModeAssignedChores.find(ac => ac.chore_id === chore.chore_id);
                        if (assigned) {
                            return {
                                ...chore,
                                assignee: assigned.assignee,
                                due_date: assigned.due_date,
                                status: assigned.status
                            };
                        }
                        return chore;
                    });
                
                case 'getAllItems':
                    return [
                        { item_id: 'ITEM001', item_name: 'ëƒ‰ì¥ê³ ' },
                        { item_id: 'ITEM002', item_name: 'ì„¸íƒê¸°' },
                        { item_id: 'ITEM003', item_name: 'ì‹ê¸°ì„¸ì²™ê¸°' }
                    ];
                
                case 'getTemplateChores':
                    return [];
                
                case 'oauthLogin':
                    // ê°œë°œ ëª¨ë“œìš© OAuth ë¡œê·¸ì¸ ì‘ë‹µ
                    return {
                        id: 'USER' + Date.now(),
                        name: data.name || 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                        nickname: 'í…ŒìŠ¤í„°',
                        email: data.email || 'test@example.com',
                        picture: data.picture || 'https://via.placeholder.com/150',
                        provider: data.provider || 'google',
                        familyGroupId: null,  // ì²˜ìŒ ë¡œê·¸ì¸ì´ë¯€ë¡œ ê°€ì¡± ì—†ìŒ
                        idInFamily: null,
                        shellCount: 0
                    };
                
                case 'assignChoreToMember':
                    // ê°œë°œ ëª¨ë“œìš© ì§‘ì•ˆì¼ í• ë‹¹ ì‘ë‹µ
                    // í• ë‹¹ëœ ì§‘ì•ˆì¼ì„ ì €ì¥
                    const assignedChore = {
                        chore_id: data.chore_id,
                        chore_name: data.chore_name,
                        choregroup_name: data.choregroup_name,
                        assignee: data.assignee,
                        family_id: data.family_id,
                        user_id: data.user_id,
                        freq_type: data.freq_type,
                        freq_value: data.freq_value,
                        status: data.status,
                        color: data.color,
                        due_date: data.due_date,
                        assigned_at: new Date().toISOString()
                    };
                    
                    // ì¤‘ë³µ ì²´í¬ í›„ ì¶”ê°€
                    const existingIndex = devModeAssignedChores.findIndex(c => c.chore_id === data.chore_id);
                    if (existingIndex >= 0) {
                        devModeAssignedChores[existingIndex] = assignedChore;
                    } else {
                        devModeAssignedChores.push(assignedChore);
                    }
                    
                    // localStorageì—ë„ ì €ì¥
                    localStorage.setItem('devModeAssignedChores', JSON.stringify(devModeAssignedChores));
                    
                    return {
                        success: true,
                        message: 'ì§‘ì•ˆì¼ì´ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        choreId: data.chore_id,
                        assignee: data.assignee,
                        dueDate: data.due_date
                    };
                
                case 'unassignChoreFromMember':
                    // ê°œë°œ ëª¨ë“œìš© ì§‘ì•ˆì¼ í• ë‹¹ ì·¨ì†Œ ì‘ë‹µ
                    // í• ë‹¹ëœ ì§‘ì•ˆì¼ì—ì„œ ì œê±°
                    const unassignIndex = devModeAssignedChores.findIndex(c => 
                        c.chore_id === data.chore_id && c.assignee === data.assignee
                    );
                    
                    if (unassignIndex >= 0) {
                        devModeAssignedChores.splice(unassignIndex, 1);
                        // localStorageì—ë„ ë°˜ì˜
                        localStorage.setItem('devModeAssignedChores', JSON.stringify(devModeAssignedChores));
                    }
                    
                    return {
                        success: true,
                        message: 'ì§‘ì•ˆì¼ í• ë‹¹ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.',
                        choreId: data.chore_id,
                        assignee: data.assignee
                    };
                
                case 'setFamilyItems':
                    // ê°œë°œ ëª¨ë“œìš© ì•„ì´í…œ ì„¤ì • ì‘ë‹µ
                    return {
                        success: true,
                        message: 'ì•„ì´í…œì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        updatedCount: data.itemIds ? data.itemIds.length : 0
                    };
                
                case 'setupFamilyChores':
                    // ê°œë°œ ëª¨ë“œìš© ì§‘ì•ˆì¼ ì„¤ì • ì‘ë‹µ
                    return {
                        success: true,
                        message: 'ì§‘ì•ˆì¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        updatedCount: data.chores ? data.chores.length : 0
                    };
                
                case 'addCustomChore':
                    // ê°œë°œ ëª¨ë“œìš© ì»¤ìŠ¤í…€ ì§‘ì•ˆì¼ ì¶”ê°€ ì‘ë‹µ
                    return {
                        success: true,
                        message: 'ìƒˆ ì§‘ì•ˆì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                        choreId: 'C' + Date.now()
                    };
                
                case 'getCustomChoreCount':
                    // ê°œë°œ ëª¨ë“œìš© ì»¤ìŠ¤í…€ ì§‘ì•ˆì¼ ê°œìˆ˜
                    return {
                        success: true,
                        count: 5
                    };
                
                default:
                    return null;
            }
        }

        // í•  ì¼ ë°ì´í„° ë¡œë“œ
        async function loadTasks() {
            try {
                const taskData = await callGAS('getTasks', { userId: currentUser.id });
                tasks = taskData.map(task => ({
                    id: task.task_id,
                    name: task.task_name,
                    category: task.category,
                    cycle: task.cycle,
                    assignee: task.assignee_id,
                    lastDate: task.last_date,
                    nextDate: task.next_date,
                    status: task.status,
                    priority: task.priority,
                    createdAt: task.created_at
                }));
            } catch (error) {
                console.error('í•  ì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”
                tasks = [];
            }
        }

        // ì˜¤ëŠ˜ í•  ì¼ ë¡œë“œ
        function loadTodayTasks() {
            const todayTasks = tasks.filter(task => {
                const today = new Date().toISOString().split('T')[0];
                return task.nextDate === today || task.status === 'in-progress';
            });

            const todayTaskList = document.getElementById('todayTaskList');
            todayTaskList.innerHTML = '';

            if (todayTasks.length === 0) {
                todayTaskList.innerHTML = '<div class="task-item"><div class="task-info">ì˜¤ëŠ˜ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤! ğŸ‰</div></div>';
                return;
            }

            todayTasks.forEach(task => {
                const taskElement = createTaskElement(task, true);
                todayTaskList.appendChild(taskElement);
            });

            // ë‚´ì¼ í•  ì¼ë„ ë¡œë“œ
            loadTomorrowTasks();
        }

        // ë‚´ì¼ í•  ì¼ ë¡œë“œ (ê°€ì¡±ì˜ ëª¨ë“  ì§‘ì•ˆì¼ í‘œì‹œ - use='Y'ì¸ ê²ƒ)
        async function loadTomorrowTasks() {
            try {
                const tomorrowTaskList = document.getElementById('tomorrowTaskList');
                tomorrowTaskList.innerHTML = '<div class="loading"><div class="spinner"></div>í•  ì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                
                // ê°€ì¡±ì˜ ëª¨ë“  ì§‘ì•ˆì¼ ì¡°íšŒ (use='Y'ì¸ ê²ƒë§Œ)
                const familyChores = await callGAS('getFamilyChores', { 
                    familyId: currentUser.familyGroupId 
                });
                
                console.log('ê°€ì¡± ì§‘ì•ˆì¼ ëª©ë¡:', familyChores);
                
            tomorrowTaskList.innerHTML = '';

                if (!familyChores || familyChores.length === 0) {
                    tomorrowTaskList.innerHTML = '<div class="task-item"><div class="task-info">ë“±ë¡ëœ ì§‘ì•ˆì¼ì´ ì—†ìŠµë‹ˆë‹¤. "â• ìƒˆë¡œìš´ í•  ì¼ ì¶”ê°€"ë¥¼ ëˆŒëŸ¬ ì¶”ê°€í•˜ì„¸ìš”.</div></div>';
                return;
            }

                // ì˜ˆì •ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ (ê¸‰í•œ ìˆœì„œëŒ€ë¡œ - ì˜ˆì •ì¼ì´ ê°€ê¹Œìš´ ê²ƒë¶€í„°)
                const sortedChores = familyChores.map(chore => {
                    const dueDate = calculateDueDate(chore);
                    return { ...chore, calculatedDueDate: new Date(dueDate) };
                }).sort((a, b) => a.calculatedDueDate - b.calculatedDueDate);

                // ì •ë ¬ëœ ìˆœì„œëŒ€ë¡œ ë Œë”ë§ (ê·¸ë£¹ ë¶„ë¥˜ ì—†ì´)
                sortedChores.forEach(chore => {
                    const choreElement = createChoreElement(chore);
                    tomorrowTaskList.appendChild(choreElement);
                });
                
            } catch (error) {
                console.error('ë‚´ì¼ í• ì¼ ë¡œë“œ ì˜¤ë¥˜:', error);
                const tomorrowTaskList = document.getElementById('tomorrowTaskList');
                tomorrowTaskList.innerHTML = '<div class="task-item"><div class="task-info" style="color: #dc2626;">âŒ í•  ì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div></div>';
            }
        }

        // ì§‘ì•ˆì¼ ì¹´ë“œ ìƒì„± (ë‚´ì¼ í• ì¼ìš© - ì„ íƒ ê°€ëŠ¥)
        function createChoreElement(chore) {
            const choreDiv = document.createElement('div');
            choreDiv.className = 'task-item';
            choreDiv.style.cssText = 'cursor: pointer; transition: all 0.2s;';
            
            // í˜¸ë²„ íš¨ê³¼
            choreDiv.onmouseenter = () => choreDiv.style.background = '#f8fafc';
            choreDiv.onmouseleave = () => choreDiv.style.background = 'white';
            
            // í´ë¦­ ì‹œ ìì‹ ì—ê²Œ í• ë‹¹
            choreDiv.onclick = async () => {
                const confirm = window.confirm(`"${chore.chore_name}"ì„(ë¥¼) ë‚´ì¼ í•  ì¼ë¡œ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
                if (confirm) {
                    await assignChoreToMe(chore);
                }
            };
            
            // ì˜ˆì •ì¼ ê³„ì‚°
            const dueDate = calculateDueDate(chore);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const dueDateObj = new Date(dueDate);
            dueDateObj.setHours(0, 0, 0, 0);
            const daysLeft = Math.ceil((dueDateObj - today) / (1000 * 60 * 60 * 24));
            
            // ê¸‰í•¨ ì •ë„ì— ë”°ë¥¸ ìƒ‰ìƒ
            let urgencyColor = '#10b981'; // ì´ˆë¡ìƒ‰ (ì—¬ìœ )
            if (daysLeft < 0) {
                urgencyColor = '#dc2626'; // ë¹¨ê°„ìƒ‰ (ì§€ë‚¨)
            } else if (daysLeft <= 1) {
                urgencyColor = '#f59e0b'; // ì£¼í™©ìƒ‰ (ê¸‰í•¨)
            } else if (daysLeft <= 3) {
                urgencyColor = '#3b82f6'; // íŒŒë€ìƒ‰ (ë³´í†µ)
            }
            
            // ì´ë¯¸ í• ë‹¹ë˜ì—ˆëŠ”ì§€ í™•ì¸
            const isAssigned = chore.assignee === currentUser.idInFamily;
            
            // ìš°ì„ ìˆœìœ„ ìƒ‰ìƒ ë§¤í•‘
            const priorityColors = {
                'red': '#dc3545',
                'blue': '#5287FA',
                'green': '#5FF0A7',
                'gray': '#6c757d',
                'black': '#000000'
            };
            const priorityColor = priorityColors[chore.color] || priorityColors['gray'];
            
            choreDiv.innerHTML = `
                <div style="width: 4px; height: 40px; border-radius: 2px; background-color: ${priorityColor}; margin-right: 12px;"></div>
                <div class="task-info" style="flex: 1;">
                    <div class="task-name" style="font-weight: 500; font-size: 1rem; margin-bottom: 6px;">
                        ${chore.chore_name}
                    </div>
                    <div class="task-meta" style="font-size: 0.85rem; color: #64748b; display: flex; flex-wrap: wrap; gap: 8px;">
                        <span>ğŸ“… ${chore.freq_type === 'd' || chore.freq_type === 'day' ? `${chore.freq_value}ì¼ë§ˆë‹¤` : `${chore.freq_value}ì£¼ë§ˆë‹¤`}</span>
                        <span style="color: ${urgencyColor}; font-weight: 500;">
                            ${daysLeft < 0 ? `âš ï¸ ${Math.abs(daysLeft)}ì¼ ì§€ë‚¨` : daysLeft === 0 ? 'ğŸ”¥ ì˜¤ëŠ˜ê¹Œì§€' : daysLeft === 1 ? 'â° ë‚´ì¼ê¹Œì§€' : `â±ï¸ ${daysLeft}ì¼ ë‚¨ìŒ`}
                        </span>
                        <span>ğŸ“† ì˜ˆì •ì¼: ${dueDateObj.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' })}</span>
                    </div>
                </div>
                <div class="task-actions">
                    <button class="btn btn-small ${isAssigned ? 'btn-success' : 'btn-primary'}" 
                            id="assign-btn-${chore.chore_id}"
                            onclick="event.stopPropagation(); toggleChoreAssignment(${JSON.stringify(chore).replace(/"/g, '&quot;')}, '${chore.chore_id}', ${isAssigned})"
                            data-assigned="${isAssigned}">
                        ${isAssigned ? 'ì„ íƒë¨' : 'ë‚´ì¼ í• ê¹Œìš”?'}
                    </button>
                </div>
            `;
            
            return choreDiv;
        }

        // ì§‘ì•ˆì¼ í• ë‹¹/ì·¨ì†Œ í† ê¸€
        async function toggleChoreAssignment(chore, choreId, isCurrentlyAssigned) {
            const button = document.getElementById(`assign-btn-${choreId}`);
            
            if (isCurrentlyAssigned) {
                // ì„ íƒ ì·¨ì†Œ
                await unassignChoreFromMe(chore, choreId, button);
            } else {
                // ì„ íƒ
                await assignChoreToMe(chore, choreId, button);
            }
        }

        // ì§‘ì•ˆì¼ì„ ë‚˜ì—ê²Œ í• ë‹¹
        async function assignChoreToMe(chore, choreId, button) {
            try {
                console.log('ì§‘ì•ˆì¼ í• ë‹¹:', chore);
                
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                if (button) {
                    button.className = 'btn btn-small btn-success';
                    button.textContent = 'ì„ íƒë¨';
                    button.setAttribute('data-assigned', 'true');
                }
                
                const taskData = {
                    chore_id: chore.chore_id,
                    chore_name: chore.chore_name,
                    choregroup_name: chore.choregroup_name,
                    assignee: currentUser.idInFamily,  // ë‚˜ì˜ ê°€ì¡± êµ¬ì„±ì› ID
                    family_id: currentUser.familyGroupId,
                    user_id: currentUser.id,
                    freq_type: chore.freq_type,
                    freq_value: chore.freq_value,
                    status: 'todo',
                    color: chore.color || 'blue',
                    due_date: getTomorrowDate()
                };
                
                const response = await callGAS('assignChoreToMember', taskData);
                
                if (response && response.success) {
                    // íŒì—… ì—†ì´ ì¡°ìš©íˆ ì„±ê³µ
                    console.log('âœ… í• ë‹¹ ì™„ë£Œ:', chore.chore_name);
                    await loadTodayTasks();  // ì˜¤ëŠ˜ í• ì¼ ìƒˆë¡œê³ ì¹¨
                } else {
                    // ì‹¤íŒ¨ ì‹œì—ë§Œ ì•Œë¦¼
                    const errorMsg = response?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    alert('âŒ í• ë‹¹ ì‹¤íŒ¨: ' + errorMsg);
                    // ë²„íŠ¼ ì›ìƒë³µêµ¬
                    if (button) {
                        button.className = 'btn btn-small btn-primary';
                        button.textContent = 'ë‚´ì¼ í• ê¹Œìš”?';
                        button.setAttribute('data-assigned', 'false');
                    }
                }
            } catch (error) {
                console.error('ì§‘ì•ˆì¼ í• ë‹¹ ì˜¤ë¥˜:', error);
                const errorMsg = error?.message || 'í• ë‹¹ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                alert(errorMsg);
                // ë²„íŠ¼ ì›ìƒë³µêµ¬
                if (button) {
                    button.className = 'btn btn-small btn-primary';
                    button.textContent = 'ë‚´ì¼ í• ê¹Œìš”?';
                    button.setAttribute('data-assigned', 'false');
                }
            }
        }

        // ì§‘ì•ˆì¼ í• ë‹¹ ì·¨ì†Œ
        async function unassignChoreFromMe(chore, choreId, button) {
            try {
                console.log('ì§‘ì•ˆì¼ í• ë‹¹ ì·¨ì†Œ:', chore);
                
                // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                if (button) {
                    button.className = 'btn btn-small btn-primary';
                    button.textContent = 'ë‚´ì¼ í• ê¹Œìš”?';
                    button.setAttribute('data-assigned', 'false');
                }
                
                const taskData = {
                    chore_id: chore.chore_id,
                    family_id: currentUser.familyGroupId,
                    assignee: currentUser.idInFamily
                };
                
                const response = await callGAS('unassignChoreFromMember', taskData);
                
                if (response && response.success) {
                    // íŒì—… ì—†ì´ ì¡°ìš©íˆ ì„±ê³µ
                    console.log('âœ… í• ë‹¹ ì·¨ì†Œ ì™„ë£Œ:', chore.chore_name);
                    await loadTodayTasks();  // ì˜¤ëŠ˜ í• ì¼ ìƒˆë¡œê³ ì¹¨
                } else {
                    // ì‹¤íŒ¨ ì‹œì—ë§Œ ì•Œë¦¼
                    const errorMsg = response?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                    alert('âŒ í• ë‹¹ ì·¨ì†Œ ì‹¤íŒ¨: ' + errorMsg);
                    // ë²„íŠ¼ ì›ìƒë³µêµ¬
                    if (button) {
                        button.className = 'btn btn-small btn-success';
                        button.textContent = 'ì„ íƒë¨';
                        button.setAttribute('data-assigned', 'true');
                    }
                }
            } catch (error) {
                console.error('ì§‘ì•ˆì¼ í• ë‹¹ ì·¨ì†Œ ì˜¤ë¥˜:', error);
                const errorMsg = error?.message || 'í• ë‹¹ ì·¨ì†Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                alert(errorMsg);
                // ë²„íŠ¼ ì›ìƒë³µêµ¬
                if (button) {
                    button.className = 'btn btn-small btn-success';
                    button.textContent = 'ì„ íƒë¨';
                    button.setAttribute('data-assigned', 'true');
                }
            }
        }

        // ì˜ˆì •ì¼ ê³„ì‚° í•¨ìˆ˜
        function calculateDueDate(chore) {
            const lastDate = chore.last_date ? new Date(chore.last_date) : new Date(currentUser.familyJoinDate || Date.now());
            lastDate.setHours(0, 0, 0, 0);
            
            const freqValue = parseInt(chore.freq_value) || 1;
            const freqType = chore.freq_type;
            
            let daysToAdd = freqValue;
            if (freqType === 'w' || freqType === 'week') {
                daysToAdd = freqValue * 7;  // ì£¼ë¥¼ ì¼ë¡œ ë³€í™˜
            }
            
            const dueDate = new Date(lastDate);
            dueDate.setDate(dueDate.getDate() + daysToAdd);
            
            return dueDate.toISOString().split('T')[0];
        }

        // ë‚´ì¼ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
        function getTomorrowDate() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            return tomorrow.toISOString().split('T')[0];
        }

        // ëª¨ë“  í•  ì¼ ë¡œë“œ
        async function loadAllTasks() {
            const allTaskList = document.getElementById('allTaskList');
            
            if (!currentUser || !currentUser.familyGroupId) {
                allTaskList.innerHTML = '<div class="empty-state">ê°€ì¡±ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            
            allTaskList.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';
            
            try {
                // ê°€ì¡±ì˜ ëª¨ë“  í™œì„±í™”ëœ ì§‘ì•ˆì¼ ê°€ì ¸ì˜¤ê¸°
                const familyChores = await callGAS('getFamilyChores', {
                    familyId: currentUser.familyGroupId
                });
                
                console.log('ê°€ì¡± ì§‘ì•ˆì¼ ëª©ë¡:', familyChores);
                
                if (!familyChores || familyChores.length === 0) {
                    allTaskList.innerHTML = '<div class="empty-state">ë“±ë¡ëœ ì§‘ì•ˆì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                // choregroup_nameë³„ë¡œ ê·¸ë£¹í™”
                const groupedChores = {};
                familyChores.forEach(chore => {
                    const group = chore.choregroup_name || 'ê¸°íƒ€';
                    if (!groupedChores[group]) {
                        groupedChores[group] = [];
                    }
                    groupedChores[group].push(chore);
                });
                
                // ê·¸ë£¹ë³„ë¡œ í‘œì‹œ
            allTaskList.innerHTML = '';
                Object.keys(groupedChores).forEach(groupName => {
                    const groupSection = document.createElement('div');
                    groupSection.className = 'chore-group';
                    groupSection.innerHTML = `<h3 class="group-title">${groupName}</h3>`;
                    
                    groupedChores[groupName].forEach(chore => {
                        const choreElement = createChoreElement(chore);
                        groupSection.appendChild(choreElement);
                    });
                    
                    allTaskList.appendChild(groupSection);
                });
                
            } catch (error) {
                console.error('ì§‘ì•ˆì¼ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                allTaskList.innerHTML = '<div class="empty-state">ì§‘ì•ˆì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // í•  ì¼ ìš”ì†Œ ìƒì„±
        function createTaskElement(task, isToday = false, showManage = false) {
            const taskItem = document.createElement('div');
            taskItem.className = `task-item ${task.status === 'completed' ? 'completed' : ''} ${task.status === 'in-progress' ? 'in-progress' : ''}`;

            const checkbox = document.createElement('div');
            checkbox.className = `task-checkbox ${task.status}`;
            checkbox.onclick = () => toggleTaskStatus(task.id);
            
            if (task.status === 'completed') {
                checkbox.innerHTML = 'âœ“';
            } else if (task.status === 'in-progress') {
                checkbox.innerHTML = 'â³';
            }

            const taskInfo = document.createElement('div');
            taskInfo.className = 'task-info';
            
            const taskName = document.createElement('div');
            taskName.className = 'task-name';
            taskName.textContent = task.name;
            
            const taskMeta = document.createElement('div');
            taskMeta.className = 'task-meta';
            taskMeta.textContent = `${task.category} â€¢ ${getCycleText(task.cycle)} â€¢ ë‹¤ìŒ: ${task.nextDate}`;
            
            taskInfo.appendChild(taskName);
            taskInfo.appendChild(taskMeta);

            const priority = document.createElement('div');
            priority.className = `task-priority priority-${task.priority}`;

            taskItem.appendChild(checkbox);
            taskItem.appendChild(taskInfo);
            taskItem.appendChild(priority);

            if (showManage) {
                const manageBtn = document.createElement('button');
                manageBtn.className = 'btn btn-secondary';
                manageBtn.style.marginLeft = '10px';
                manageBtn.style.padding = '5px 10px';
                manageBtn.textContent = 'ìˆ˜ì •';
                manageBtn.onclick = () => editTask(task.id);
                taskItem.appendChild(manageBtn);
            }

            return taskItem;
        }

        // í•  ì¼ ìƒíƒœ í† ê¸€
        async function toggleTaskStatus(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            let newStatus;
            // ìƒíƒœ ìˆœí™˜: todo -> in-progress -> completed -> todo
            switch(task.status) {
                case 'todo':
                    newStatus = 'in-progress';
                    break;
                case 'in-progress':
                    newStatus = 'completed';
                    break;
                case 'completed':
                    newStatus = 'todo';
                    break;
                default:
                    newStatus = 'todo';
            }

            try {
                // ì„œë²„ì— ìƒíƒœ ì—…ë°ì´íŠ¸ ìš”ì²­
                await callGAS('updateTask', {
                    task_id: taskId,
                    status: newStatus,
                    assignee_id: task.assignee
                });

                // ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                task.status = newStatus;

                // ì™„ë£Œ ì‹œ ë‹¤ìŒ ë‚ ì§œ ê³„ì‚°
                if (newStatus === 'completed') {
                    updateNextDate(task);
                    currentUser.shellCount++;
                } else if (task.status === 'completed' && newStatus !== 'completed') {
                    currentUser.shellCount = Math.max(0, currentUser.shellCount - 1);
                }

                // UI ì—…ë°ì´íŠ¸
                loadTodayTasks();
                updateShellCount();
            } catch (error) {
                console.error('í•  ì¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                alert('ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹¤ìŒ ë‚ ì§œ ê³„ì‚°
        function updateNextDate(task) {
            const lastDate = new Date(task.lastDate);
            let nextDate = new Date(lastDate);

            // ì»¤ìŠ¤í…€ ì£¼ê¸° ì²˜ë¦¬
            if (task.cycle && task.cycle.includes('custom_days_')) {
                const days = parseInt(task.cycle.split('_')[2]);
                nextDate.setDate(nextDate.getDate() + days);
            } else if (task.cycle && task.cycle.includes('custom_weeks_')) {
                const weeks = parseInt(task.cycle.split('_')[2]);
                nextDate.setDate(nextDate.getDate() + (weeks * 7));
            } else {
                switch(task.cycle) {
                    case 'daily':
                        nextDate.setDate(nextDate.getDate() + 1);
                        break;
                    case 'weekly':
                        nextDate.setDate(nextDate.getDate() + 7);
                        break;
                    case 'monthly':
                        nextDate.setMonth(nextDate.getMonth() + 1);
                        break;
                    case 'quarterly':
                        nextDate.setMonth(nextDate.getMonth() + 3);
                        break;
                    case 'yearly':
                        nextDate.setFullYear(nextDate.getFullYear() + 1);
                        break;
                }
            }

            task.lastDate = new Date().toISOString().split('T')[0];
            task.nextDate = nextDate.toISOString().split('T')[0];
        }

        // ì£¼ê¸° ì„ íƒ ë³€ê²½ í•¸ë“¤ëŸ¬
        function handleCycleChange() {
            const cycleSelect = document.getElementById('taskCycle');
            const customGroup = document.getElementById('customCycleGroup');
            const customLabel = document.getElementById('customCycleLabel');
            const customUnit = document.getElementById('customCycleUnit');
            const customHint = document.getElementById('customCycleHint');
            const customInput = document.getElementById('customCycleValue');
            
            if (cycleSelect.value === 'custom_days') {
                customGroup.style.display = 'block';
                customLabel.textContent = 'ë©°ì¹ ë§ˆë‹¤';
                customUnit.textContent = 'ì¼';
                customHint.textContent = '1ì¼ë¶€í„° 6ì¼ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
                customInput.min = 1;
                customInput.max = 6;
                customInput.value = '';
            } else if (cycleSelect.value === 'custom_weeks') {
                customGroup.style.display = 'block';
                customLabel.textContent = 'ëª‡ì£¼ë§ˆë‹¤';
                customUnit.textContent = 'ì£¼';
                customHint.textContent = '1ì£¼ë¶€í„° 52ì£¼ê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
                customInput.min = 1;
                customInput.max = 52;
                customInput.value = '';
            } else {
                customGroup.style.display = 'none';
                customInput.value = '';
            }
        }

        // ì£¼ê¸° í…ìŠ¤íŠ¸ ë³€í™˜
        function getCycleText(cycle) {
            const cycleMap = {
                'daily': 'ë§¤ì¼',
                'weekly': 'ë§¤ì£¼',
                'monthly': 'ë§¤ë‹¬',
                'quarterly': 'ë¶„ê¸°',
                'yearly': 'ë§¤ë…„'
            };
            
            // ì»¤ìŠ¤í…€ ì£¼ê¸° ì²˜ë¦¬
            if (cycle && cycle.includes('custom_')) {
                const parts = cycle.split('_');
                if (parts.length === 3) {
                    const value = parts[2];
                    const unit = parts[1] === 'days' ? 'ì¼ë§ˆë‹¤' : 'ì£¼ë§ˆë‹¤';
                    return `${value}${unit}`;
                }
            }
            
            return cycleMap[cycle] || cycle;
        }

        // ì¹´í…Œê³ ë¦¬ ë¡œë“œ
        async function loadCategories() {
            console.log('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì‹œì‘...');
            try {
                const categories = await callGAS('getCategories');
                console.log('ë¡œë“œëœ ì¹´í…Œê³ ë¦¬:', categories);
                
                const categorySelect = document.getElementById('taskCategory');
                if (!categorySelect) {
                    console.error('taskCategory ì„ íƒ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ê¸°ì¡´ ì˜µì…˜ ì œê±° (ì²« ë²ˆì§¸ ì„ íƒ ì˜µì…˜ ì œì™¸)
                categorySelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
                
                // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì¶”ê°€
                if (Array.isArray(categories) && categories.length > 0) {
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                    console.log('ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì¶”ê°€ ì™„ë£Œ:', categories.length + 'ê°œ');
                } else {
                    console.warn('ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                    loadDefaultCategories(categorySelect);
                }
            } catch (error) {
                console.error('ì¹´í…Œê³ ë¦¬ ë¡œë“œ ì˜¤ë¥˜:', error);
                const categorySelect = document.getElementById('taskCategory');
                loadDefaultCategories(categorySelect);
            }
        }

        // ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ë¡œë“œ
        function loadDefaultCategories(categorySelect) {
            const defaultCategories = ['ì£¼ë°©', 'ê±°ì‹¤', 'í™”ì¥ì‹¤', 'ë² ë€ë‹¤', 'ë°©', 'ì°¨', 'ì°½ë¬¸', 'ê³„ì ˆ', 'ê¸°íƒ€'];
            console.log('ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ì‚¬ìš©:', defaultCategories);
            
            categorySelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            defaultCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });
        }

        // ê°€ì¡± êµ¬ì„±ì› ë¡œë“œ
        async function loadFamilyMembers() {
            try {
                const userInfo = await callGAS('getUserInfo', { userId: currentUser.id });
                const familyData = await callGAS('getFamilyMembers', { familyId: userInfo.family_id });
                
                familyMembers = familyData.map(member => ({
                    id: member.user_id,
                    name: member.name,
                    nickname: member.nickname,
                    phone: member.phone,
                    shellCount: member.shell_count || 0
                }));
            } catch (error) {
                console.error('ê°€ì¡± êµ¬ì„±ì› ë¡œë“œ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ì‹œ ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                familyMembers = getSampleData('getFamilyMembers');
            }
        }

        // ê°€ì¡± ë°ì´í„° ë¡œë“œ
        async function loadFamilyData() {
            await loadMyFamilies();
            await loadCurrentFamilyMembers();
        }

        // ë‚´ê°€ ì†í•œ ê°€ì¡± ëª©ë¡ ë¡œë“œ
        async function loadMyFamilies() {
            const myFamiliesList = document.getElementById('myFamiliesList');
            
            if (!currentUser || !currentUser.id) {
                myFamiliesList.innerHTML = '<div class="empty-state">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>';
                return;
            }
            
            try {
                myFamiliesList.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';
                
                const families = await callGAS('getAllFamiliesByUserId', {
                    userId: currentUser.id
                });
                
                console.log('ë‚´ê°€ ì†í•œ ê°€ì¡±ë“¤:', families);
                
                if (!families || families.length === 0) {
                    myFamiliesList.innerHTML = '<div class="empty-state">ì•„ì§ ê°€ì¡±ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                myFamiliesList.innerHTML = '';
                families.forEach(family => {
                    const familyCard = document.createElement('div');
                    familyCard.className = 'family-card' + (family.family_id === currentUser.familyGroupId ? ' active' : '');
                    familyCard.style.cssText = `
                        padding: 1rem;
                        border: 2px solid ${family.family_id === currentUser.familyGroupId ? 'rgb(82, 135, 250)' : '#e5e7eb'};
                        border-radius: 8px;
                        margin-bottom: 0.5rem;
                        cursor: pointer;
                        transition: all 0.2s;
                        background: ${family.family_id === currentUser.familyGroupId ? '#eff6ff' : 'white'};
                    `;
                    
                    familyCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold; font-size: 1.1rem; margin-bottom: 0.25rem;">
                                    ${family.family_name}
                                </div>
                                <div style="font-size: 0.875rem; color: #666;">
                                    ë‚´ ë‹‰ë„¤ì„: ${family.nick_infamily} â€¢ ì—­í• : ${family.role === 'owner' ? 'ğŸ‘‘ ë°©ì¥' : 'ğŸ‘¤ ë©¤ë²„'}
                                </div>
                            </div>
                            ${family.family_id === currentUser.familyGroupId ? 
                                '<span style="color: rgb(82, 135, 250); font-weight: bold;">âœ“ í˜„ì¬ ì„ íƒ</span>' : 
                                '<span style="color: #999; font-size: 0.875rem;">í´ë¦­í•˜ì—¬ ì„ íƒ</span>'
                            }
                        </div>
                    `;
                    
                    familyCard.onclick = () => selectFamily(family);
                    myFamiliesList.appendChild(familyCard);
                });
                
            } catch (error) {
                console.error('ê°€ì¡± ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                myFamiliesList.innerHTML = '<div class="empty-state">ê°€ì¡± ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ê°€ì¡± ì„ íƒ
        function selectFamily(family) {
            currentUser.familyGroupId = family.family_id;
            currentUser.idInFamily = family.id_infamily;
            currentUser.nickInFamily = family.nick_infamily;
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // UI ì—…ë°ì´íŠ¸
            loadMyFamilies();
            loadCurrentFamilyMembers();
            
            // ì˜¤ëŠ˜/ë‚´ì¼ í• ì¼ ìƒˆë¡œê³ ì¹¨
            if (document.getElementById('today').classList.contains('active')) {
                loadTodayTasks();
            } else if (document.getElementById('manage').classList.contains('active')) {
                loadAllTasks();
            }
        }

        // í˜„ì¬ ì„ íƒëœ ê°€ì¡±ì˜ êµ¬ì„±ì› ë¡œë“œ
        async function loadCurrentFamilyMembers() {
            const familyList = document.getElementById('familyList');
            
            if (!currentUser || !currentUser.familyGroupId) {
                familyList.innerHTML = '<div class="empty-state">ê°€ì¡±ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            
            try {
                familyList.innerHTML = '<div class="loading">ë¡œë”© ì¤‘...</div>';
                
                const members = await callGAS('getFamilyMembers', {
                    familyId: currentUser.familyGroupId
                });
                
                console.log('ê°€ì¡± êµ¬ì„±ì›:', members);
                
                if (!members || members.length === 0) {
                    familyList.innerHTML = '<div class="empty-state">ê°€ì¡± êµ¬ì„±ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                familyList.innerHTML = '';
                members.forEach(member => {
                const memberElement = document.createElement('div');
                memberElement.className = 'family-member';
                    memberElement.style.cssText = `
                        display: flex;
                        align-items: center;
                        padding: 1rem;
                        border: 1px solid #e5e7eb;
                        border-radius: 8px;
                        margin-bottom: 0.5rem;
                    `;

                memberElement.innerHTML = `
                        <div class="member-avatar" style="
                            width: 50px;
                            height: 50px;
                            border-radius: 50%;
                            background: linear-gradient(135deg, rgb(95, 240, 167), rgb(82, 135, 250));
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 1.5rem;
                            font-weight: bold;
                            color: white;
                            margin-right: 1rem;
                        ">${member.nick_infamily.charAt(0)}</div>
                        <div class="member-info" style="flex: 1;">
                            <div class="member-name" style="font-weight: bold; margin-bottom: 0.25rem;">
                                ${member.nick_infamily} 
                                ${member.role === 'owner' ? '<span style="color: rgb(82, 135, 250);">ğŸ‘‘</span>' : ''}
                                ${member.id_infamily === currentUser.idInFamily ? '<span style="color: #999; font-size: 0.875rem;">(ë‚˜)</span>' : ''}
                            </div>
                            <div class="member-id" style="font-size: 0.875rem; color: #666;">ID: ${member.id_infamily}</div>
                    </div>
                `;

                familyList.appendChild(memberElement);
            });
                
            } catch (error) {
                console.error('ê°€ì¡± êµ¬ì„±ì› ë¡œë“œ ì˜¤ë¥˜:', error);
                familyList.innerHTML = '<div class="empty-state">ê°€ì¡± êµ¬ì„±ì›ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ì¡°ê°œ ê°œìˆ˜ ë¡œë“œ
        function loadShellCount() {
            updateShellCount();
        }

        // ì¡°ê°œ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        function updateShellCount() {
            document.getElementById('shellCount').textContent = currentUser.shellCount;
        }

        // ë³´ìƒ ë°ì´í„° ë¡œë“œ
        function loadRewardData() {
            updateShellCount();
            
            // ì™„ë£Œ í†µê³„ ê³„ì‚°
            const today = new Date().toISOString().split('T')[0];
            const thisWeekStart = new Date();
            thisWeekStart.setDate(thisWeekStart.getDate() - thisWeekStart.getDay());
            const thisMonthStart = new Date();
            thisMonthStart.setDate(1);

            const todayCompleted = tasks.filter(task => 
                task.status === 'completed' && task.lastDate === today
            ).length;

            const weekCompleted = tasks.filter(task => 
                task.status === 'completed' && new Date(task.lastDate) >= thisWeekStart
            ).length;

            const monthCompleted = tasks.filter(task => 
                task.status === 'completed' && new Date(task.lastDate) >= thisMonthStart
            ).length;

            document.getElementById('todayCompletedCount').textContent = `${todayCompleted}ê°œ`;
            document.getElementById('weekCompletedCount').textContent = `${weekCompleted}ê°œ`;
            document.getElementById('monthCompletedCount').textContent = `${monthCompleted}ê°œ`;
        }

        // ëª¨ë‹¬ ì—´ê¸°
        function openAddTaskModal() {
            document.getElementById('addTaskModal').classList.add('active');
            // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì£¼ê¸° ì„ íƒì„ ì´ˆê¸°í™”
            document.getElementById('customCycleGroup').style.display = 'none';
            // ì¹´í…Œê³ ë¦¬ ë‹¤ì‹œ ë¡œë“œ
            loadCategories();
        }

        function openTemplateModal() {
            document.getElementById('templateModal').classList.add('active');
            // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì´ˆê¸°í™”
            document.getElementById('templateCycle').value = '';
            document.getElementById('templateTaskList').innerHTML = '<p style="color: #666; text-align: center; margin: 20px 0;">ì£¼ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>';
        }

        // openScheduleModal í•¨ìˆ˜ ì œê±°

        // ê°€ì¡± ì°¾ê¸° ëª¨ë‹¬ ì—´ê¸°
        function openFindFamilyModal() {
            document.getElementById('findFamilyModal').classList.add('active');
            document.getElementById('searchFamilyName').value = '';
            document.getElementById('searchFamilyResult').innerHTML = '';
            document.getElementById('joinFamilyForm').style.display = 'none';
        }

        // ê°€ì¡± ê²€ìƒ‰
        let foundFamilyToJoin = null;
        async function searchFamily() {
            const familyNameInput = document.getElementById('searchFamilyName');
            const familyName = familyNameInput.value.trim();
            const resultDiv = document.getElementById('searchFamilyResult');
            const joinForm = document.getElementById('joinFamilyForm');
            const similarSection = document.getElementById('similarFamiliesSection');
            const createNewSection = document.getElementById('createNewFamilySection');
            const similarList = document.getElementById('similarFamiliesList');
            
            if (!familyName) {
                resultDiv.innerHTML = '<span style="color: #dc2626;">ê°€ì¡± ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
                return;
            }
            
            try {
                resultDiv.innerHTML = '<span style="color: #666;">ê²€ìƒ‰ ì¤‘...</span>';
                similarSection.style.display = 'none';
                createNewSection.style.display = 'none';
                joinForm.style.display = 'none';
                
                const response = await callGAS('checkFamilyName', {
                    familyName: familyName
                });
                
                console.log('ê°€ì¡± ê²€ìƒ‰ ê²°ê³¼:', response);
                
                if (response && response.error) {
                    resultDiv.innerHTML = '<span style="color: #dc2626;">âŒ ' + (response.message || 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.') + '</span>';
                    return;
                }
                
                // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°€ì¡±ì´ ìˆëŠ” ê²½ìš°
                if (response && response.exists && response.exactMatch) {
                    foundFamilyToJoin = response.family;
                    resultDiv.innerHTML = `
                        <div style="padding: 1rem; background: #eff6ff; border-radius: 8px; border: 1px solid rgb(82, 135, 250);">
                            <div style="color: rgb(82, 135, 250); font-weight: bold; margin-bottom: 0.5rem;">âœ… ê°€ì¡±ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!</div>
                            <div style="font-size: 0.875rem; color: #666;">
                                <div><strong>ê°€ì¡± ì´ë¦„:</strong> ${foundFamilyToJoin.name}</div>
                                <div><strong>í˜„ì¬ êµ¬ì„±ì›:</strong> ${foundFamilyToJoin.memberCount || 0}ëª…</div>
                            </div>
                        </div>
                    `;
                    
                    // ê°€ì… í¼ í‘œì‹œ
                    selectFamilyToJoin(foundFamilyToJoin);
                    
                } else {
                    // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°€ì¡±ì´ ì—†ëŠ” ê²½ìš°
                    foundFamilyToJoin = null;
                    resultDiv.innerHTML = '<span style="color: #dc2626;">âŒ "' + familyName + '" ì´ë¦„ì˜ ê°€ì¡±ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>';
                    
                    // ë¹„ìŠ·í•œ ê°€ì¡±ì´ ìˆëŠ”ì§€ í™•ì¸
                    if (response && response.similarFamilies && response.similarFamilies.length > 0) {
                        similarList.innerHTML = '';
                        response.similarFamilies.forEach(family => {
                            const familyCard = document.createElement('div');
                            familyCard.style.cssText = `
                                padding: 1rem;
                                border: 1px solid #e5e7eb;
                                border-radius: 8px;
                                margin-bottom: 0.5rem;
                                cursor: pointer;
                                transition: all 0.2s;
                            `;
                            familyCard.onmouseover = () => familyCard.style.borderColor = 'rgb(82, 135, 250)';
                            familyCard.onmouseout = () => familyCard.style.borderColor = '#e5e7eb';
                            
                            familyCard.innerHTML = `
                                <div style="font-weight: bold; margin-bottom: 0.25rem;">${family.name}</div>
                                <div style="font-size: 0.875rem; color: #666;">
                                    êµ¬ì„±ì› ${family.memberCount || 0}ëª… â€¢ ìƒì„±ì¼: ${new Date(family.created_at).toLocaleDateString()}
                                </div>
                            `;
                            
                            familyCard.onclick = () => selectFamilyToJoin(family);
                            similarList.appendChild(familyCard);
                        });
                        similarSection.style.display = 'block';
                    }
                    
                    // ìƒˆ ê°€ì¡± ë§Œë“¤ê¸° ë²„íŠ¼ í‘œì‹œ
                    createNewSection.style.display = 'block';
                }
            } catch (error) {
                console.error('ê°€ì¡± ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                resultDiv.innerHTML = '<span style="color: #dc2626;">âŒ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</span>';
                similarSection.style.display = 'none';
                createNewSection.style.display = 'none';
            }
        }

        // ê°€ì¡± ì„ íƒí•˜ì—¬ ê°€ì… í¼ í‘œì‹œ
        function selectFamilyToJoin(family) {
            foundFamilyToJoin = family;
            
            document.getElementById('selectedFamilyId').value = family.id;
            document.getElementById('selectedFamilyName').value = family.name;
            document.getElementById('selectedFamilyDisplay').textContent = `"${family.name}" ê°€ì¡±ì— ê°€ì…í•©ë‹ˆë‹¤`;
            
            document.getElementById('joinFamilyForm').style.display = 'block';
            document.getElementById('joinFamilyNickname').value = '';
            document.getElementById('joinFamilyNickname').focus();
            
            // ìŠ¤í¬ë¡¤ì„ í¼ìœ¼ë¡œ ì´ë™
            document.getElementById('joinFamilyForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ê°€ì… ì·¨ì†Œ
        function cancelJoinFamily() {
            document.getElementById('joinFamilyForm').style.display = 'none';
            foundFamilyToJoin = null;
        }

        // ê²€ìƒ‰ì—ì„œ ìƒˆ ê°€ì¡± ë§Œë“¤ê¸°
        async function openCreateFamilyFromSearch() {
            // ê²€ìƒ‰í•œ ê°€ì¡± ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const searchedName = document.getElementById('searchFamilyName').value.trim();
            
            // ê°€ì¡± ì°¾ê¸°ì— ì‹¤íŒ¨í–ˆì„ ë•Œ ë©”ì‹œì§€
            const confirmCreate = confirm(
                'ğŸ’¡ ì•ˆë‚´\n\n' +
                'ìƒˆ ê°€ì¡±ì„ ë§Œë“¤ë©´ ê¸°ì¡´ ê°€ì¡±ê³¼ ì—°ë™ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n' +
                'í•œ ì‚¬ëŒì€ ì—¬ëŸ¬ ê°€ì¡±ì— ì†Œì†ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n' +
                'ìƒˆ ê°€ì¡±ì„ ë§Œë“œì‹œê² ìŠµë‹ˆê¹Œ?'
            );
            
            if (!confirmCreate) {
                return;
            }
            
            // ê°€ì¡± ì°¾ê¸° ëª¨ë‹¬ ë‹«ê¸°
            closeModal('findFamilyModal');
            
            // ê°€ì¡± ë“±ë¡ ëª¨ë‹¬ ì—´ê¸°
            showFamilyRegistrationModal();
            
            // ê²€ìƒ‰í•œ ì´ë¦„ì„ ìë™ìœ¼ë¡œ ì…ë ¥
            if (searchedName) {
                document.getElementById('familyNameInput').value = searchedName;
                document.getElementById('familyNicknameInput').focus();
            }
        }

        // ê°€ì¡± ì´ˆëŒ€ ëª¨ë‹¬ ì—´ê¸°
        function openInviteModal() {
            if (!currentUser || !currentUser.familyGroupId) {
                alert('ë¨¼ì € ê°€ì¡±ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('inviteModal').classList.add('active');
            
            // í˜„ì¬ ê°€ì¡± ì •ë³´ í‘œì‹œ
            document.getElementById('currentFamilyName').textContent = currentUser.familyName || currentUser.familyGroupId;
            
            // ì´ˆëŒ€ ë§í¬ ìƒì„±
            const inviteLink = `${window.location.origin}${window.location.pathname}?invite=${currentUser.familyGroupId}`;
            document.getElementById('inviteLink').value = inviteLink;
        }

        // ì´ˆëŒ€ ë§í¬ ë³µì‚¬
        function copyInviteLink() {
            const inviteLinkInput = document.getElementById('inviteLink');
            inviteLinkInput.select();
            document.execCommand('copy');
            
            alert('ì´ˆëŒ€ ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function openAlarmModal() {
            document.getElementById('alarmModal').classList.add('active');
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // í•  ì¼ ì¶”ê°€ ì²˜ë¦¬
        async function handleAddTask(event) {
            event.preventDefault();
            
            const taskName = document.getElementById('taskName').value;
            const taskCategory = document.getElementById('taskCategory').value;
            const taskCycleSelect = document.getElementById('taskCycle').value;
            
            // ì»¤ìŠ¤í…€ ì£¼ê¸° ì²˜ë¦¬
            let freqType = 'day';
            let freqValue = 1;
            
            if (taskCycleSelect === 'custom_days') {
                const customValue = document.getElementById('customCycleValue').value;
                
                if (!customValue) {
                    alert('ì£¼ê¸° ê°„ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const value = parseInt(customValue);
                if (value < 1 || value > 30) {
                    alert('ë©°ì¹ ë§ˆë‹¤ëŠ” 1ì¼ë¶€í„° 30ì¼ê¹Œì§€ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }
                
                freqType = 'day';
                freqValue = value;
            } else if (taskCycleSelect === 'custom_weeks') {
                const customValue = document.getElementById('customCycleValue').value;
                
                if (!customValue) {
                    alert('ì£¼ê¸° ê°„ê²©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                const value = parseInt(customValue);
                if (value < 1 || value > 52) {
                    alert('ëª‡ì£¼ë§ˆë‹¤ëŠ” 1ì£¼ë¶€í„° 52ì£¼ê¹Œì§€ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    return;
                }
                
                freqType = 'week';
                freqValue = value;
            }

            try {
                // 1. ë¨¼ì € ì‚¬ìš©ì ì •ì˜ ì§‘ì•ˆì¼ ê°œìˆ˜ í™•ì¸
                const countInfo = await callGAS('getCustomChoreCount', {
                    familyId: currentUser.familyGroupId
                });
                
                if (countInfo.count >= 30) {
                    alert('âŒ ìµœëŒ€ 30ê°œì˜ ì‚¬ìš©ì ì •ì˜ ì§‘ì•ˆì¼ê¹Œì§€ë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní˜„ì¬: ' + countInfo.count + '/30ê°œ');
                    return;
                }
                
                // 2. ìƒˆë¡œìš´ ì§‘ì•ˆì¼ ì¶”ê°€ (Chore_main + Chore_family ë™ì‹œ ì¶”ê°€)
                const newChoreData = {
                    familyId: currentUser.familyGroupId,
                    choreName: taskName,
                    choreGroupName: taskCategory,
                    freqType: freqType,
                    freqValue: freqValue
                };

                console.log('ìƒˆë¡œìš´ í•  ì¼ ì¶”ê°€:', newChoreData);
                const response = await callGAS('addCustomChore', newChoreData);
                
                if (!response.success) {
                    alert('âŒ ' + response.message);
                    return;
                }
                
                // í•  ì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadTomorrowTasks();
                
                // ì„±ê³µ ë©”ì‹œì§€
                alert(`âœ… "${taskName}"ì´(ê°€) ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì‚¬ìš©ì ì •ì˜ ì§‘ì•ˆì¼: ${countInfo.count + 1}/30ê°œ\në‚¨ì€ ê°œìˆ˜: ${response.remaining}ê°œ`);
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('addTaskForm').reset();
                document.getElementById('customCycleGroup').style.display = 'none';
                closeModal('addTaskModal');
                
                // UI ì—…ë°ì´íŠ¸
                loadTodayTasks();
                loadAllTasks();
            } catch (error) {
                console.error('í•  ì¼ ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('í•  ì¼ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‹¤ìŒ ë‚ ì§œ ê³„ì‚° (ìƒˆ í•  ì¼ìš©)
        function calculateNextDate(cycle) {
            const today = new Date();
            let nextDate = new Date(today);

            // ì»¤ìŠ¤í…€ ì£¼ê¸° ì²˜ë¦¬
            if (cycle && cycle.includes('custom_days_')) {
                const days = parseInt(cycle.split('_')[2]);
                nextDate.setDate(nextDate.getDate() + days);
            } else if (cycle && cycle.includes('custom_weeks_')) {
                const weeks = parseInt(cycle.split('_')[2]);
                nextDate.setDate(nextDate.getDate() + (weeks * 7));
            } else {
                switch(cycle) {
                    case 'daily':
                        nextDate.setDate(nextDate.getDate() + 1);
                        break;
                    case 'weekly':
                        nextDate.setDate(nextDate.getDate() + 7);
                        break;
                    case 'monthly':
                        nextDate.setMonth(nextDate.getMonth() + 1);
                        break;
                    case 'quarterly':
                        nextDate.setMonth(nextDate.getMonth() + 3);
                        break;
                    case 'yearly':
                        nextDate.setFullYear(nextDate.getFullYear() + 1);
                        break;
                    default:
                        nextDate.setDate(nextDate.getDate() + 1);
                }
            }

            return nextDate.toISOString().split('T')[0];
        }

        // ê°€ì¡± ì´ˆëŒ€ ì²˜ë¦¬
        // ê°€ì¡± ê°€ì… ì²˜ë¦¬
        async function handleJoinFamily(event) {
            event.preventDefault();
            
            if (!foundFamilyToJoin) {
                alert('ë¨¼ì € ê°€ì¡±ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const nickname = document.getElementById('joinFamilyNickname').value.trim();
            
            if (!nickname) {
                alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const response = await callGAS('joinFamily', {
                    userId: currentUser.id,
                    familyId: foundFamilyToJoin.id,
                    nickInFamily: nickname
                });
                
                console.log('ê°€ì¡± ê°€ì… ì‘ë‹µ:', response);
                
                if (response && response.idInFamily) {
                    // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                    currentUser.familyGroupId = foundFamilyToJoin.id;
                    currentUser.idInFamily = response.idInFamily;
                    currentUser.nickInFamily = nickname;
                    currentUser.familyName = foundFamilyToJoin.name;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    alert(`"${foundFamilyToJoin.name}" ê°€ì¡±ì— ê°€ì…ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰`);
                    
                    // ëª¨ë‹¬ ë‹«ê¸°
                    closeModal('findFamilyModal');
                    
                    // ê°€ì¡± íƒ­ìœ¼ë¡œ ì´ë™
                    showTab('family');
                    loadFamilyData();
                } else {
                    alert('ê°€ì¡± ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('ê°€ì¡± ê°€ì… ì˜¤ë¥˜:', error);
                alert('ê°€ì¡± ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function handleInvite(event) {
            event.preventDefault();
            
            // ì´ˆëŒ€ ëª¨ë‹¬ì€ ë§í¬ ë³µì‚¬ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìœ¼ë¯€ë¡œ ë” ì´ìƒ í¼ ì œì¶œì´ í•„ìš” ì—†ìŒ
            closeModal('inviteModal');
        }

        // ì•ŒëŒ ì„¤ì • ì²˜ë¦¬
        function handleAlarmSetting(event) {
            event.preventDefault();
            
            const time = document.getElementById('alarmTime').value;
            const days = Array.from(document.querySelectorAll('#alarmForm input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            
            alert(`ì•ŒëŒì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!\nì‹œê°„: ${time}\nìš”ì¼: ${days.join(', ')}`);
            
            document.getElementById('alarmForm').reset();
            closeModal('alarmModal');
        }

        // í•  ì¼ ìˆ˜ì •
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const newName = prompt('í•  ì¼ ì´ë¦„ì„ ìˆ˜ì •í•˜ì„¸ìš”:', task.name);
            if (newName && newName !== task.name) {
                task.name = newName;
                loadAllTasks();
                alert('í•  ì¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }

        // í…œí”Œë¦¿ ë°ì´í„° ì •ì˜ (README ê¸°ë°˜)
        const templateTasks = {
            daily: [
                'ì„¤ê±°ì§€', 'ë°”ë‹¥ì²­ì†Œ', 'ì¹¨êµ¬ì •ë¦¬', 'ë¹¨ë˜', 'ìŒì‹ë¬¼ì“°ë ˆê¸°', 
                'ë¶€ì—Œ ê°œìˆ˜ëŒ€', 'í™”ì¥ì‹¤ ìˆ˜ì±„êµ¬ë©', 'ë°¥í•˜ê¸°', 'ë°˜ì°¬í•˜ê¸°'
            ],
            weekly: [
                'ì¥ë³´ê¸°', 'í™”ì¥ì‹¤ì²­ì†Œ(ë³€ê¸°, ë°”ë‹¥, ì„¸ë©´ëŒ€)', 'ë¶„ë¦¬ìˆ˜ê±°', 'ì“°ë ˆê¸°ë²„ë¦¬ê¸°', 
                'ì •ìˆ˜ê¸° ê´€ë¦¬', 'ë¹„ìš°ê¸°ì²¼ë¦°ì§€'
            ],
            monthly: [
                'í˜„ê´€', 'ë² ë€ë‹¤', 'ë°©í–¥ì œ ê´€ë¦¬', 'ê°€êµ¬ë¨¼ì§€ì œê±°', 'ë² ê²Œì´ë¶ˆì„¸íƒ', 
                'ìŠ¤í…ê·¸ë¦‡/ëƒ„ë¹„ ê´€ë¦¬', 'ì „ìë ˆì¸ì§€/í† ìŠ¤íŠ¸ê¸° ê´€ë¦¬', 'ì—ì–´í›„ë¼ì´ê¸° ê´€ë¦¬', 
                'ì¸ë•ì…˜/ê°€ìŠ¤ë Œì§€ ê´€ë¦¬', 'ì„¸íƒê¸° í†µì„¸íƒ', 'ìŒì‹ë¬¼ì“°ë ˆê¸°ê´€ë¦¬', 
                'ì—ì–´ì»¨í•„í„° ë¬¼ì„¸ì²™', 'ê³µê¸°ì²­ì •ê¸° í•„í„° ë¬¼ì„¸ì²™', 'ê°€ìŠµê¸° ì²­ì†Œ'
            ],
            quarterly: [
                'ì¹¨êµ¬ë³€ê²½', 'ìš´ë™í™”/ì‹ ë°œ', 'ì²­ì†Œê¸°í†µ ë¹„ìš°ê¸°/ë¡œë´‡ì²­ì†Œê¸° ê´€ë¦¬', 'ì‹ê¸°ì„¸ì²™ê¸°ê´€ë¦¬', 
                'ì£¼ë°©í›„íŠ¸ì²­ì†Œ', 'ìš´ë™í™”/ì‹ ë°œ ë¹¨ë˜', 'ìƒ¤ì›Œê¸°/ì„¸ë©´ëŒ€/ì£¼ë°©ìˆ˜ì „/ë¹„ëŒ€ í•„í„°êµì²´', 
                'ì •ìˆ˜ê¸°í•„í„° êµì²´ ë° ì™¸ë¶€ì„¸ì²™'
            ],
            yearly: [
                'í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬ ë„£ê¸° (1ì›”)', 'ê²¨ìš¸ì˜· ë„£ê³  ë°˜íŒ”ì˜· êº¼ë‚´ê¸°(4ì›”)', 
                'ì»¤íŠ¼ë¹¨ë˜(4ì›”)', 'ì°¨ ì™€ì´í¼ êµì²´ (5ì›”)', 'ì„ í’ê¸°êº¼ë‚´ê¸° (5ì›”)', 
                'ì˜·ì¥ ì‹ ë°œì¥ ì œìŠµì œ(6ì›”)', 'ëª¨ê¸°ì¥ ì„¤ì¹˜ (8ì›”)', 'ì„ í’ê¸°ë„£ê¸° (9ì›”)', 
                'ì—¬ë¦„ì˜· ì •ë¦¬, ê¸´íŒ” ì™¸íˆ¬ êº¼ë‚´ê¸°(9ì›”)', 'ì „ê¸°ì¥íŒ/ë‚œë°©ê¸° êº¼ë‚´ê¸° (10ì›”)', 
                'ì°¨ ì—ì–´ì»¨í•„í„° (10ì›” ì´ˆ)'
            ]
        };

        // í…œí”Œë¦¿ í•  ì¼ ë¡œë“œ
        function loadTemplateTasks() {
            const cycle = document.getElementById('templateCycle').value;
            const taskList = document.getElementById('templateTaskList');
            
            if (!cycle) {
                taskList.innerHTML = '<p style="color: #666; text-align: center; margin: 20px 0;">ì£¼ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>';
                return;
            }
            
            const tasks = templateTasks[cycle] || [];
            taskList.innerHTML = '';
            
            tasks.forEach((task, index) => {
                const taskItem = document.createElement('div');
                taskItem.style.cssText = 'display: flex; align-items: center; padding: 8px; border-bottom: 1px solid #f0f0f0;';
                
                taskItem.innerHTML = `
                    <input type="checkbox" id="template_${index}" value="${task}" style="margin-right: 10px;">
                    <label for="template_${index}" style="flex: 1; cursor: pointer;">${task}</label>
                `;
                
                taskList.appendChild(taskItem);
            });
        }

        // í…œí”Œë¦¿ ì¶”ê°€ ì²˜ë¦¬
        async function handleTemplateAdd(event) {
            event.preventDefault();
            
            const cycle = document.getElementById('templateCycle').value;
            const selectedTasks = Array.from(document.querySelectorAll('#templateTaskList input[type="checkbox"]:checked'))
                .map(cb => cb.value);
            
            if (selectedTasks.length === 0) {
                alert('ì¶”ê°€í•  í•  ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const userInfo = await callGAS('getUserInfo', { userId: currentUser.id });
                const familyMember = await callGAS('getFamilyMemberByUserId', { userId: currentUser.id });
                
                let addedCount = 0;
                for (const taskName of selectedTasks) {
                    const newTaskData = {
                        task_name: taskName,
                        category: getCategoryFromTaskName(taskName),
                        choregroup_name: getCategoryFromTaskName(taskName),
                        cycle: cycle,
                        assignee_id: familyMember ? familyMember.id_infamily : currentUser.id,
                        family_id: userInfo.family_id,
                        status: 'todo',
                        priority: 'gray',
                        freq_type: cycle === 'daily' ? 'day' : 'week',
                        freq_value: cycle === 'daily' ? 1 : (cycle === 'weekly' ? 1 : (cycle === 'monthly' ? 4 : (cycle === 'quarterly' ? 12 : 52)))
                    };
                    
                    await callGAS('addTask', newTaskData);
                    addedCount++;
                }
                
                // í•  ì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                await loadTasks();
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('templateForm').reset();
                closeModal('templateModal');
                
                // UI ì—…ë°ì´íŠ¸
                loadTodayTasks();
                loadAllTasks();
                
                alert(`${addedCount}ê°œì˜ í•  ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
            } catch (error) {
                console.error('í…œí”Œë¦¿ ì¶”ê°€ ì˜¤ë¥˜:', error);
                alert('í…œí”Œë¦¿ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í•  ì¼ ì´ë¦„ì—ì„œ ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
        function getCategoryFromTaskName(taskName) {
            if (taskName.includes('ì„¤ê±°ì§€') || taskName.includes('ë¶€ì—Œ') || taskName.includes('ë°¥') || taskName.includes('ë°˜ì°¬')) {
                return 'ì£¼ë°©';
            } else if (taskName.includes('ë°”ë‹¥') || taskName.includes('ê±°ì‹¤')) {
                return 'ê±°ì‹¤';
            } else if (taskName.includes('í™”ì¥ì‹¤') || taskName.includes('ìƒ¤ì›Œê¸°') || taskName.includes('ì„¸ë©´ëŒ€')) {
                return 'í™”ì¥ì‹¤';
            } else if (taskName.includes('ë² ë€ë‹¤')) {
                return 'ë² ë€ë‹¤';
            } else if (taskName.includes('ì¹¨êµ¬') || taskName.includes('ë² ê°œ') || taskName.includes('ì´ë¶ˆ')) {
                return 'ì•ˆë°©';
            } else if (taskName.includes('ì°¨') || taskName.includes('ì™€ì´í¼') || taskName.includes('ì—ì–´ì»¨')) {
                return 'ìë™ì°¨';
            } else if (taskName.includes('ì˜·') || taskName.includes('ì»¤íŠ¼') || taskName.includes('ëª¨ê¸°ì¥')) {
                return 'ê³„ì ˆ';
            } else {
                return 'ê¸°íƒ€';
            }
        }

        // Google OAuth ì„¤ì •
        const GOOGLE_CLIENT_ID = '376793805883-8ub45glt9dd098ggkl3uhqjc14gn60k2.apps.googleusercontent.com'; // Google API í‚¤ (OAuth í´ë¼ì´ì–¸íŠ¸ ID í•„ìš”)
        
        // Google Sign-In ì´ˆê¸°í™”
        function initializeGoogleSignIn() {
            console.log('Google Sign-In ì´ˆê¸°í™” ì‹œë„...');
            console.log('í´ë¼ì´ì–¸íŠ¸ ID:', GOOGLE_CLIENT_ID);
            
            if (typeof google !== 'undefined' && google.accounts) {
                try {
                    google.accounts.id.initialize({
                        client_id: GOOGLE_CLIENT_ID,
                        callback: handleGoogleCredentialResponse,
                        auto_select: false,
                        cancel_on_tap_outside: true
                    });
                    console.log('âœ… Google Sign-In ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ Google Sign-In ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                }
            } else {
                console.warn('âš ï¸ Google APIê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•ŠìŒ. 1ì´ˆ í›„ ì¬ì‹œë„...');
                setTimeout(initializeGoogleSignIn, 1000);
            }
        }

        // OAuth ë¡œê·¸ì¸ í•¨ìˆ˜ë“¤
        function loginWithGoogle() {
            console.log('ğŸ”µ Google ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ë¨');
            console.log('í´ë¼ì´ì–¸íŠ¸ ID:', GOOGLE_CLIENT_ID);
            
            // ê°œë°œ ëª¨ë“œì—ì„œëŠ” í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë¡œ ìë™ ë¡œê·¸ì¸
            if (isDevelopmentMode) {
                console.log('ğŸ”§ ê°œë°œ ëª¨ë“œ: í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë¡œ ìë™ ë¡œê·¸ì¸');
                const testUserData = {
                    provider: 'google',
                    email: 'test@example.com',
                    name: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì',
                    picture: 'https://via.placeholder.com/150',
                    id_token: 'dev_token_' + Date.now(),
                    google_id: 'DEV_USER_ID'
                };
                processOAuthLogin(testUserData);
                return;
            }
            
            if (typeof google === 'undefined' || !google.accounts) {
                console.error('âŒ Google APIê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ:', typeof google);
                alert('Google Sign-In APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\ní•´ê²° ë°©ë²•:\n1. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  1-2ì´ˆ ëŒ€ê¸°\n2. ì¸í„°ë„· ì—°ê²° í™•ì¸\n3. ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ');
                return;
            }

            console.log('âœ… Google API ë¡œë“œ í™•ì¸ë¨');
            console.log('ğŸš€ íŒì—… ë¡œê·¸ì¸ ì‹œë„ ì¤‘...');

            // One Tap ëŒ€ì‹  ì§ì ‘ íŒì—… ë°©ì‹ ì‚¬ìš©
            try {
                showGoogleLoginPopup();
            } catch (error) {
                console.error('âŒ Google ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('Google ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜¤ë¥˜: ' + error.message + '\n\në¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // Google ë¡œê·¸ì¸ íŒì—… í‘œì‹œ
        function showGoogleLoginPopup() {
            console.log('ğŸ”“ OAuth íŒì—… í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì¤‘...');
            
            try {
                const client = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: 'openid email profile',
                    callback: async (tokenResponse) => {
                        console.log('âœ… í† í° ì‘ë‹µ ìˆ˜ì‹ :', tokenResponse);
                        
                        if (tokenResponse.error) {
                            console.error('âŒ í† í° ì˜¤ë¥˜:', tokenResponse.error);
                            alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜: ' + tokenResponse.error);
                            return;
                        }
                        
                        if (tokenResponse.access_token) {
                            console.log('âœ… ì•¡ì„¸ìŠ¤ í† í° íšë“, ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì¤‘...');
                            await getUserInfoFromGoogle(tokenResponse.access_token);
                        }
                    },
                });
                
                console.log('ğŸš€ íŒì—… ì—´ê¸° ìš”ì²­...');
                client.requestAccessToken();
            } catch (error) {
                console.error('âŒ íŒì—… ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('íŒì—… ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message);
            }
        }

        // Google í¬ë ˆë´ì…œ ì‘ë‹µ ì²˜ë¦¬ (One Tap ë˜ëŠ” ë²„íŠ¼ í´ë¦­)
        async function handleGoogleCredentialResponse(response) {
            console.log('âœ… Google í¬ë ˆë´ì…œ ìˆ˜ì‹ :', response);
            
            try {
                // JWT í† í° ë””ì½”ë”©
                const payload = parseJwt(response.credential);
                console.log('âœ… JWT íŒŒì‹± ì™„ë£Œ:', payload);
                
                const userData = {
                    provider: 'google',
                    email: payload.email,
                    name: payload.name,
                    picture: payload.picture,
                    id_token: response.credential,
                    google_id: payload.sub
                };

                console.log('ì‚¬ìš©ì ë°ì´í„° ì¤€ë¹„:', userData);
                await processOAuthLogin(userData);
            } catch (error) {
                console.error('âŒ Google ë¡œê·¸ì¸ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // Google ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì•¡ì„¸ìŠ¤ í† í° ì‚¬ìš©)
        async function getUserInfoFromGoogle(accessToken) {
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v2/userinfo', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }

                const userInfo = await response.json();
                
                const userData = {
                    provider: 'google',
                    email: userInfo.email,
                    name: userInfo.name,
                    picture: userInfo.picture,
                    id_token: accessToken,
                    google_id: userInfo.id
                };

                await processOAuthLogin(userData);
            } catch (error) {
                console.error('Google ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // JWT í† í° íŒŒì‹±
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error('JWT íŒŒì‹± ì˜¤ë¥˜:', error);
                return null;
            }
        }

        function loginWithApple() {
            // Apple Sign In ì„¤ì •
            const clientId = 'YOUR_APPLE_CLIENT_ID'; // ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ IDë¡œ ë³€ê²½ í•„ìš”
            const redirectUri = window.location.origin + window.location.pathname;
            const scope = 'name email';
            
            const authUrl = `https://appleid.apple.com/auth/authorize?` +
                `client_id=${clientId}&` +
                `redirect_uri=${encodeURIComponent(redirectUri)}&` +
                `response_type=code&` +
                `scope=${encodeURIComponent(scope)}&` +
                `response_mode=form_post`;
            
            // Apple ë¡œê·¸ì¸ì€ ìƒˆ ì°½ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            window.location.href = authUrl;
        }

        // OAuth ë¡œê·¸ì¸ ì²˜ë¦¬ (í†µí•©)
        async function processOAuthLogin(userData) {
            try {
                // ë¡œë”© í‘œì‹œ
                console.log('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...', userData);

                // ì„œë²„ì— ì‚¬ìš©ì ì •ë³´ ì €ì¥/ì—…ë°ì´íŠ¸
                const response = await callGAS('oauthLogin', {
                    provider: userData.provider,
                    email: userData.email,
                    name: userData.name,
                    picture: userData.picture,
                    id_token: userData.id_token,
                    google_id: userData.google_id
                });

                if (response && response.id) {
                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
                    currentUser = {
                        id: response.id,
                        idInFamily: response.idInFamily || null,  // ê°€ì¡± êµ¬ì„±ì› ID (ì˜ˆ: F1728123456_1)
                        name: response.name,
                        nickname: response.nickname || 'ë‚˜',
                        familyGroup: response.familyGroup || null,
                        familyGroupId: response.familyGroupId || null,
                        shellCount: response.shellCount || 0,
                        email: response.email,
                        picture: response.picture,
                        provider: userData.provider
                    };
                    
                    localStorage.setItem('isLoggedIn', 'true');
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // ê°€ì¡± ê·¸ë£¹ì´ ì—†ìœ¼ë©´ ê°€ì¡± ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ
                    if (!currentUser.familyGroupId) {
                        console.log('ê°€ì¡± ê·¸ë£¹ ì—†ìŒ -> ê°€ì¡± ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ');
                        showFamilyRegistrationModal();
                    } else {
                        // ë©”ì¸ ì•±ìœ¼ë¡œ ì´ë™
                        showMainApp();
                        alert(`í™˜ì˜í•©ë‹ˆë‹¤, ${currentUser.name}ë‹˜!`);
                    }
                } else {
                    alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + response.message);
                }
            } catch (error) {
                console.error('OAuth ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ê°€ì¡± ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ
        function showFamilyRegistrationModal() {
            closeModal('authModal');
            document.getElementById('familyRegistrationModal').style.display = 'flex';
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('familyNameInput').value = '';
            document.getElementById('familyNicknameInput').value = '';
            document.getElementById('familyCheckResult').innerHTML = '';
            document.getElementById('existingFamilyInfo').style.display = 'none';
            document.getElementById('confirmJoinFamily').checked = false;
        }

        // ê°€ì¡± ì´ë¦„ ì¤‘ë³µ í™•ì¸
        let foundFamily = null;
        
        async function checkFamilyName() {
            const familyName = document.getElementById('familyNameInput').value.trim();
            const resultDiv = document.getElementById('familyCheckResult');
            const existingFamilyInfo = document.getElementById('existingFamilyInfo');
            const nicknameInput = document.getElementById('familyNicknameInput');
            
            if (!familyName) {
                resultDiv.innerHTML = '<span style="color: #dc2626;">âŒ ê°€ì¡± ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
                return;
            }

            try {
                resultDiv.innerHTML = '<span style="color: #666;">ğŸ” ê²€ìƒ‰ ì¤‘...</span>';
                existingFamilyInfo.style.display = 'none';
                
                // ì„œë²„ì— ê°€ì¡± ì´ë¦„ ê²€ìƒ‰ ìš”ì²­
                const response = await callGAS('checkFamilyName', {
                    familyName: familyName
                });

                console.log('ê°€ì¡± ì´ë¦„ í™•ì¸ ì‘ë‹µ:', response);

                // ì—ëŸ¬ ì²´í¬
                if (response && response.error) {
                    resultDiv.innerHTML = '<span style="color: #dc2626;">âŒ ' + (response.message || 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.') + '</span>';
                    return;
                }

                // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°€ì¡±ì´ ìˆëŠ” ê²½ìš°
                if (response && response.exists && response.exactMatch) {
                    foundFamily = response.family;
                    
                    // ì‚¬ìš©ìì—ê²Œ ë¬¼ì–´ë³´ê¸°
                    const confirmJoin = confirm(
                        `"${foundFamily.name}" ê°€ì¡±ì´ ìˆìŠµë‹ˆë‹¤.\n\n` +
                        `í˜„ì¬ êµ¬ì„±ì›: ${foundFamily.memberCount || 0}ëª…\n` +
                        `ìƒì„±ì¼: ${new Date(foundFamily.created_at).toLocaleDateString()}\n\n` +
                        `ì´ ê°€ì¡±ìœ¼ë¡œ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
                    );
                    
                    if (confirmJoin) {
                        // ê¸°ì¡´ ê°€ì¡± ì •ë³´ í‘œì‹œ
                        resultDiv.innerHTML = '<span style="color: rgb(82, 135, 250);">âœ… "' + foundFamily.name + '" ê°€ì¡±ì— ê°€ì…í•©ë‹ˆë‹¤.</span>';
                        document.getElementById('existingFamilyDetails').innerHTML = `
                            <div><strong>ê°€ì¡± ì´ë¦„:</strong> ${foundFamily.name}</div>
                            <div><strong>ìƒì„±ì¼:</strong> ${new Date(foundFamily.created_at).toLocaleDateString()}</div>
                            <div><strong>êµ¬ì„±ì› ìˆ˜:</strong> ${foundFamily.memberCount || 0}ëª…</div>
                        `;
                        existingFamilyInfo.style.display = 'block';
                        document.getElementById('confirmJoinFamily').checked = true;
                        
                        // ë‹‰ë„¤ì„ ì…ë ¥ë€ìœ¼ë¡œ í¬ì»¤ìŠ¤ ì´ë™
                        nicknameInput.focus();
                    } else {
                        // ì‚¬ìš©ìê°€ ê±°ì ˆí•˜ë©´ ì´ˆê¸°í™”
                        foundFamily = null;
                        resultDiv.innerHTML = '<span style="color: #666;">ë‹¤ë¥¸ ê°€ì¡± ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
                    }
                    
                } else if (response && !response.exists) {
                    // ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê°€ì¡±ì´ ì—†ëŠ” ê²½ìš°
                    foundFamily = null;
                    
                    // ë¹„ìŠ·í•œ ê°€ì¡±ì´ ìˆëŠ”ì§€ í™•ì¸
                    if (response.similarFamilies && response.similarFamilies.length > 0) {
                        // ë¹„ìŠ·í•œ ê°€ì¡± ëª©ë¡ ìƒì„±
                        let similarList = response.similarFamilies.slice(0, 3).map(f => 
                            `  â€¢ ${f.name} (êµ¬ì„±ì› ${f.memberCount || 0}ëª…)`
                        ).join('\n');
                        
                        const searchSimilar = confirm(
                            `"${familyName}" ê°€ì¡±ì´ ì—†ìŠµë‹ˆë‹¤.\n\n` +
                            `ë¹„ìŠ·í•œ ì´ë¦„ì˜ ê°€ì¡±ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤:\n${similarList}\n\n` +
                            `ë¹„ìŠ·í•œ ê°€ì¡±ì„ ì°¾ì•„ë³´ì‹œê² ìŠµë‹ˆê¹Œ?\n` +
                            `(ì•„ë‹ˆì˜¤ë¥¼ ì„ íƒí•˜ë©´ ìƒˆ ê°€ì¡±ìœ¼ë¡œ ë“±ë¡ë©ë‹ˆë‹¤)`
                        );
                        
                        if (searchSimilar) {
                            // ê°€ì¡± ì°¾ê¸° ëª¨ë‹¬ë¡œ ì´ë™
                            closeModal('familyRegistrationModal');
                            openFindFamilyModal();
                            document.getElementById('searchFamilyName').value = familyName;
                            searchFamily();
                        } else {
                            // ìƒˆ ê°€ì¡± ë“±ë¡
                            resultDiv.innerHTML = '<span style="color: rgb(95, 240, 167); font-weight: bold;">âœ… "' + familyName + '"ë¡œ ìƒˆ ê°€ì¡±ì„ ë“±ë¡í•©ë‹ˆë‹¤.</span>';
                            nicknameInput.focus();
                        }
                    } else {
                        // ë¹„ìŠ·í•œ ê°€ì¡±ë„ ì—†ëŠ” ê²½ìš°
                        const confirmNew = confirm(
                            `"${familyName}" ê°€ì¡±ì´ ì—†ìŠµë‹ˆë‹¤.\n\n` +
                            `ìƒˆë¡œìš´ ê°€ì¡± ì´ë¦„ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
                        );
                        
                        if (confirmNew) {
                            resultDiv.innerHTML = '<span style="color: rgb(95, 240, 167); font-weight: bold;">âœ… "' + familyName + '"ë¡œ ìƒˆ ê°€ì¡±ì„ ë“±ë¡í•©ë‹ˆë‹¤.</span>';
                            nicknameInput.focus();
                        } else {
                            resultDiv.innerHTML = '<span style="color: #666;">ë‹¤ë¥¸ ê°€ì¡± ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
                        }
                    }
                } else {
                    resultDiv.innerHTML = '<span style="color: #dc2626;">âŒ ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</span>';
                }
            } catch (error) {
                console.error('ê°€ì¡± ì´ë¦„ í™•ì¸ ì˜¤ë¥˜:', error);
                resultDiv.innerHTML = '<span style="color: #dc2626;">âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message + '</span>';
                existingFamilyInfo.style.display = 'none';
            }
        }

        // ìš°ë¦¬ì§‘ ì§‘ì•ˆì¼ ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ
        async function showChoreSetupModal() {
            const modal = document.getElementById('choreSetupModal');
            const choreSetupList = document.getElementById('choreSetupList');
            
            modal.style.display = 'flex';
            
            try {
                // ì„œë²„ì—ì„œ í…œí”Œë¦¿ ì§‘ì•ˆì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° (template=1)
                choreSetupList.innerHTML = '<div style="text-align: center; padding: 40px; color: #94a3b8;"><div style="font-size: 2rem; margin-bottom: 10px;">ğŸ§¹</div>ì§‘ì•ˆì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                
                const response = await callGAS('getTemplateChores', {});
                
                if (response && response.length > 0) {
                    // choregroup_nameë³„ë¡œ ê·¸ë£¹í™”
                    const groupedChores = {};
                    response.forEach(chore => {
                        const group = chore.choregroup_name || 'ê¸°íƒ€';
                        if (!groupedChores[group]) {
                            groupedChores[group] = [];
                        }
                        groupedChores[group].push(chore);
                    });
                    
                    // ì§‘ì•ˆì¼ ëª©ë¡ ë Œë”ë§
                    let html = '<div style="display: grid; gap: 20px;">';
                    
                    Object.keys(groupedChores).forEach(groupName => {
                        html += `
                            <div style="border: 2px solid #e2e8f0; border-radius: 12px; padding: 15px; background: white;">
                                <div style="font-weight: bold; font-size: 1.1rem; color: #1e293b; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0;">
                                    ğŸ“‚ ${groupName}
                                </div>
                                <div style="display: grid; gap: 10px;">
                        `;
                        
                        groupedChores[groupName].forEach(chore => {
                            const freqUnit = (chore.freq_type === 'd' || chore.freq_type === 'day') ? 'ì¼' : 'ì£¼';
                            html += `
                                <div style="display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; background: #f8fafc;">
                                    <input type="checkbox" 
                                           data-chore-id="${chore.chore_id}" 
                                           checked 
                                           style="width: 20px; height: 20px; cursor: pointer;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 500; color: #1e293b;">${chore.chore_name}</div>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <input type="number" 
                                               data-chore-id="${chore.chore_id}" 
                                               data-freq-type="${chore.freq_type}"
                                               class="freq-input"
                                               value="${chore.freq_value}" 
                                               min="1" 
                                               max="${(chore.freq_type === 'd' || chore.freq_type === 'day') ? '30' : '52'}"
                                               style="width: 60px; padding: 5px; border: 1px solid #cbd5e1; border-radius: 4px; text-align: center;">
                                        <span style="color: #64748b; min-width: 30px;">${freqUnit}ë§ˆë‹¤</span>
                                    </div>
                                </div>
                            `;
                        });
                        
                        html += `
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    choreSetupList.innerHTML = html;
                } else {
                    choreSetupList.innerHTML = '<div style="text-align: center; padding: 40px; color: #94a3b8;"><div style="font-size: 2rem; margin-bottom: 10px;">ğŸ“­</div>í…œí”Œë¦¿ ì§‘ì•ˆì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ì§‘ì•ˆì¼ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
                choreSetupList.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;"><div style="font-size: 2rem; margin-bottom: 10px;">âš ï¸</div>ì§‘ì•ˆì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ì§‘ì•ˆì¼ ì„¤ì • í¼ ì œì¶œ
        document.addEventListener('DOMContentLoaded', function() {
            const choreSetupForm = document.getElementById('choreSetupForm');
            if (choreSetupForm) {
                choreSetupForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const checkboxes = document.querySelectorAll('#choreSetupList input[type="checkbox"]');
                    const freqInputs = document.querySelectorAll('#choreSetupList input.freq-input');
                    
                    const choreSettings = [];
                    
                    checkboxes.forEach(checkbox => {
                        const choreId = checkbox.getAttribute('data-chore-id');
                        const isChecked = checkbox.checked;
                        const freqInput = document.querySelector(`input.freq-input[data-chore-id="${choreId}"]`);
                        const freqValue = parseInt(freqInput.value);
                        const freqType = freqInput.getAttribute('data-freq-type');
                        
                        choreSettings.push({
                            chore_id: choreId,
                            use: isChecked ? 'Y' : 'N',
                            freq_value: freqValue,
                            freq_type: freqType
                        });
                    });
                    
                    try {
                        const submitBtn = document.getElementById('choreSetupSubmitBtn');
                        submitBtn.disabled = true;
                        submitBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
                        
                        const response = await callGAS('setupFamilyChores', {
                            familyId: currentUser.familyGroupId,
                            choreSettings: choreSettings
                        });
                        
                        if (response.success) {
                            // ëª¨ë‹¬ ë‹«ê¸°
                            document.getElementById('choreSetupModal').style.display = 'none';
                            
                            // ë©”ì¸ ì•± í‘œì‹œ
                            showMainApp();
                            alert(`ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤! ${currentUser.familyGroup}ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.\nì§‘ì•ˆì¼: ${response.activeCount}ê°œ í™œì„±í™”`);
                        } else {
                            alert('ì˜¤ë¥˜: ' + (response.message || 'ì§‘ì•ˆì¼ ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
                        }
                    } catch (error) {
                        console.error('ì§‘ì•ˆì¼ ì„¤ì • ì˜¤ë¥˜:', error);
                        alert('ì§‘ì•ˆì¼ ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    } finally {
                        const submitBtn = document.getElementById('choreSetupSubmitBtn');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'âœ… ì„¤ì • ì™„ë£Œ';
                    }
                });
            }
        });

        // ì•„ì´í…œ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
        async function showItemSelectionModal() {
            const modal = document.getElementById('itemSelectionModal');
            const itemsList = document.getElementById('itemsList');
            
            modal.style.display = 'flex';
            
            try {
                // ì„œë²„ì—ì„œ ì•„ì´í…œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                itemsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #94a3b8;"><div style="font-size: 2rem; margin-bottom: 10px;">ğŸ“¦</div>ì•„ì´í…œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
                
                const response = await callGAS('getAllItems', {});
                
                if (response && response.length > 0) {
                    // ì•„ì´í…œ ëª©ë¡ ë Œë”ë§
                    let html = '<div style="display: grid; gap: 8px;">';
                    
                    response.forEach(item => {
                        html += `
                            <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; transition: all 0.2s;" 
                                   onmouseover="this.style.borderColor='rgb(82, 135, 250)'; this.style.background='#f8fafc';" 
                                   onmouseout="this.style.borderColor='#e2e8f0'; this.style.background='white';">
                                <input type="checkbox" name="selectedItems" value="${item.item_id}" 
                                       checked 
                                       style="margin-right: 12px; width: 18px; height: 18px; cursor: pointer;">
                                <span style="font-size: 1rem; color: #1e293b;">${item.item_name}</span>
                            </label>
                        `;
                    });
                    
                    html += '</div>';
                    itemsList.innerHTML = html;
                } else {
                    itemsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #94a3b8;"><div style="font-size: 2rem; margin-bottom: 10px;">ğŸ“­</div>ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ì•„ì´í…œ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:', error);
                itemsList.innerHTML = '<div style="text-align: center; padding: 40px; color: #dc2626;"><div style="font-size: 2rem; margin-bottom: 10px;">âš ï¸</div>ì•„ì´í…œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ì•„ì´í…œ ì„ íƒ í¼ ì œì¶œ
        document.addEventListener('DOMContentLoaded', function() {
            const itemForm = document.getElementById('itemSelectionForm');
            if (itemForm) {
                itemForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const checkboxes = document.querySelectorAll('input[name="selectedItems"]:checked');
                    const selectedItemIds = Array.from(checkboxes).map(cb => cb.value);
                    
                    try {
                        const submitBtn = document.getElementById('itemSubmitBtn');
                        submitBtn.disabled = true;
                        submitBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
                        
                        const response = await callGAS('setFamilyItems', {
                            familyId: currentUser.familyGroupId,
                            itemIds: selectedItemIds
                        });
                        
                        if (response.success) {
                            // ëª¨ë‹¬ ë‹«ê¸°
                            document.getElementById('itemSelectionModal').style.display = 'none';
                            
                            // ìš°ë¦¬ì§‘ ì§‘ì•ˆì¼ ë“±ë¡ ëª¨ë‹¬ í‘œì‹œ
                            showChoreSetupModal();
                        } else {
                            alert('ì˜¤ë¥˜: ' + (response.message || 'ì•„ì´í…œ ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
                        }
                    } catch (error) {
                        console.error('ì•„ì´í…œ ì„¤ì • ì˜¤ë¥˜:', error);
                        alert('ì•„ì´í…œ ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    } finally {
                        const submitBtn = document.getElementById('itemSubmitBtn');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'âœ… ì„ íƒ ì™„ë£Œ';
                    }
                });
            }
        });

        // ê°€ì¡± ë“±ë¡ í¼ ì œì¶œ
        document.addEventListener('DOMContentLoaded', function() {
            const familyForm = document.getElementById('familyRegistrationForm');
            if (familyForm) {
                familyForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const familyName = document.getElementById('familyNameInput').value.trim();
                    const nickname = document.getElementById('familyNicknameInput').value.trim();
                    const confirmJoin = document.getElementById('confirmJoinFamily').checked;

                    if (!familyName || !nickname) {
                        alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return;
                    }

                    // ê¸°ì¡´ ê°€ì¡±ì— ê°€ì…í•˜ëŠ” ê²½ìš° í™•ì¸
                    if (foundFamily && !confirmJoin) {
                        alert('ê¸°ì¡´ ê°€ì¡±ì— ê°€ì…í•˜ë ¤ë©´ ì²´í¬ë°•ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                    }

                    try {
                        const submitBtn = document.getElementById('familyRegisterBtn');
                        submitBtn.disabled = true;
                        submitBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';

                        let response;
                        
                        if (foundFamily) {
                            // ê¸°ì¡´ ê°€ì¡±ì— ê°€ì…
                            response = await callGAS('joinFamily', {
                                userId: currentUser.id,
                                familyId: foundFamily.id,
                                nickname: nickname
                            });
                        } else {
                            // ìƒˆ ê°€ì¡± ìƒì„±
                            response = await callGAS('createFamily', {
                                userId: currentUser.id,
                                familyName: familyName,
                                nickname: nickname
                            });
                        }

                        if (response.success) {
                            // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                            currentUser.familyGroup = familyName;
                            currentUser.familyGroupId = response.familyId;
                            currentUser.idInFamily = response.idInFamily || (response.familyId + '_1');  // ê°€ì¡± êµ¬ì„±ì› ID
                            currentUser.nickname = nickname;
                            currentUser.familyJoinDate = response.joinDate || new Date().toISOString().split('T')[0];  // ê°€ì¡± ê°€ì…ì¼
                            localStorage.setItem('currentUser', JSON.stringify(currentUser));

                            // ëª¨ë‹¬ ë‹«ê¸°
                            document.getElementById('familyRegistrationModal').style.display = 'none';
                            
                            // ì•„ì´í…œ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ
                            showItemSelectionModal();
                        } else {
                            alert('ì˜¤ë¥˜: ' + (response.message || 'ê°€ì¡± ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'));
                        }
                    } catch (error) {
                        console.error('ê°€ì¡± ë“±ë¡ ì˜¤ë¥˜:', error);
                        alert('ê°€ì¡± ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    } finally {
                        const submitBtn = document.getElementById('familyRegisterBtn');
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'ê°€ì¡± ë“±ë¡';
                    }
                });
            }
        });

        // URLì—ì„œ OAuth ì½œë°± ì²˜ë¦¬
        function handleOAuthCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');

            if (error) {
                alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error);
                return;
            }

            if (code) {
                // Google OAuth ì½œë°± ì²˜ë¦¬
                handleGoogleCallback(code);
            }
        }

        // Google OAuth ì½œë°± ì²˜ë¦¬
        async function handleGoogleCallback(code) {
            try {
                const response = await callGAS('googleOAuthCallback', {
                    code: code,
                    redirect_uri: window.location.origin + window.location.pathname
                });

                if (response.success) {
                    handleOAuthSuccess(response.user);
                } else {
                    alert('Google ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + response.message);
                }
            } catch (error) {
                console.error('Google OAuth ì½œë°± ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ë©”ì¼ ë¡œê·¸ì¸ ì²˜ë¦¬ (ë¯¸êµ¬í˜„ - í˜„ì¬ëŠ” OAuthë§Œ ì§€ì›)
        function handleLogin(event) {
            event.preventDefault();
            console.log('ì´ë©”ì¼ ë¡œê·¸ì¸ ì‹œë„');
            alert('í˜„ì¬ëŠ” Google ë˜ëŠ” Apple ë¡œê·¸ì¸ë§Œ ì§€ì›í•©ë‹ˆë‹¤.');
            closeModal('authModal');
        }

        // íšŒì›ê°€ì… ì²˜ë¦¬ (ë¯¸êµ¬í˜„ - í˜„ì¬ëŠ” OAuthë§Œ ì§€ì›)
        function handleSignup(event) {
            event.preventDefault();
            console.log('íšŒì›ê°€ì… ì‹œë„');
            alert('í˜„ì¬ëŠ” Google ë˜ëŠ” Apple ë¡œê·¸ì¸ë§Œ ì§€ì›í•©ë‹ˆë‹¤.\në¡œê·¸ì¸ ì‹œ ìë™ìœ¼ë¡œ ê³„ì •ì´ ìƒì„±ë©ë‹ˆë‹¤.');
            closeModal('authModal');
        }

        // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜ë“¤
        function openLoginModal() {
            document.getElementById('authModal').classList.add('active');
            switchAuthTab('login');
        }

        function openSignupModal() {
            document.getElementById('authModal').classList.add('active');
            switchAuthTab('signup');
        }

        // ì¸ì¦ íƒ­ ì „í™˜
        function switchAuthTab(tab) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
            currentUser = {
                id: 'USER001',
                name: 'ì‚¬ìš©ì',
                nickname: 'ë‹‰ë„¤ì„',
                familyGroup: 'ìš°ë¦¬ê°€ì¡±',
                shellCount: 0
            };
            showLandingPage();
            alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>
